<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Post Page â€” Chinese60s</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3235921032748480" crossorigin="anonymous"></script>
  <style>
    :root {
      --black: #222;
      --green: #7cb83e;
      --green-dark: #5a8f27;
      --green-light: #d8f0a0;
      --green-pale: #f2fde0;
      --yellow: #ffd84d;
      --yellow-pale: #fffbe6;
      --peach: #ffb89a;
      --peach-pale: #fff3ee;
      --sky: #72c8f0;
      --sky-pale: #eaf8ff;
      --lavender: #c5b0f8;
      --lavender-pale: #f3f0ff;
      --pink: #ffadc5;
      --pink-pale: #fff2f6;
      --white: #fff;
      --bg: #fffef5;
      --shadow-sm: 3px 3px 0 var(--black);
      --shadow-md: 4px 4px 0 var(--black);
      --shadow-lg: 6px 6px 0 var(--black);
      --border: 2.5px solid var(--black);
      --border-thick: 3px solid var(--black);
    }

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }

    body {
      font-family: 'Fredoka', sans-serif;
      font-weight: 500;
      background: var(--bg);
      color: var(--black);
      overflow-x: hidden;
      min-height: 100vh;
      display: flex; flex-direction: column;
    }
    body::before {
      content: '';
      position: fixed; inset: 0;
      background-image: radial-gradient(circle, rgba(0,0,0,0.045) 1px, transparent 1px);
      background-size: 22px 22px;
      pointer-events: none; z-index: 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    header {
      background: var(--green);
      border-bottom: var(--border-thick);
      padding: 0 50px; height: 66px;
      display: flex; justify-content: space-between; align-items: center;
      position: sticky; top: 0; z-index: 100;
    }
    header h1 {
      font-weight: 700; font-size: 1.7rem; color: white;
      letter-spacing: 0.04em; text-shadow: 2px 2px 0 rgba(0,0,0,0.25);
    }
    .homepage-link { text-decoration: none; color: inherit; }
    .menu-toggle { display: none; font-size: 24px; background: none; border: none; color: white; cursor: pointer; }

    nav { display: flex; align-items: center; }
    nav ul { list-style: none; display: flex; gap: 8px; align-items: center; }
    nav ul li a {
      text-decoration: none; color: var(--black);
      font-weight: 600; font-size: 0.95rem;
      background: var(--white); border: var(--border); border-radius: 50px;
      padding: 6px 16px; display: inline-block;
      box-shadow: var(--shadow-sm); transition: transform 0.12s, box-shadow 0.12s;
    }
    nav ul li a:hover { transform: translate(-2px,-2px); box-shadow: 5px 5px 0 var(--black); }

    /* â”€â”€ AUTH PILL in nav â”€â”€ */
    .auth-pill {
      display: flex; align-items: center; gap: 8px;
      background: var(--white); border: var(--border); border-radius: 50px;
      padding: 5px 14px 5px 6px;
      box-shadow: var(--shadow-sm);
      cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s;
      font-weight: 600; font-size: 0.9rem; color: var(--black);
      text-decoration: none; white-space: nowrap;
    }
    .auth-pill:hover { transform: translate(-2px,-2px); box-shadow: 5px 5px 0 var(--black); }
    .auth-pill .avatar {
      width: 28px; height: 28px; border-radius: 50%;
      border: 2px solid var(--black); object-fit: cover;
      background: var(--green-light);
      display: flex; align-items: center; justify-content: center;
      font-size: 0.85rem; font-weight: 700; overflow: hidden;
      flex-shrink: 0;
    }
    .auth-pill .avatar img { width: 100%; height: 100%; object-fit: cover; }

    /* sign-in pill (no avatar) */
    #sign-in-btn {
      background: var(--yellow); border: var(--border); border-radius: 50px;
      padding: 6px 18px; font-weight: 700; font-size: 0.9rem;
      box-shadow: var(--shadow-sm); cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s;
      display: flex; align-items: center; gap: 6px;
      font-family: 'Fredoka', sans-serif;
    }
    #sign-in-btn:hover { transform: translate(-2px,-2px); box-shadow: 5px 5px 0 var(--black); }

    /* user dropdown */
    .user-menu-wrap { position: relative; }
    .user-dropdown {
      display: none;
      position: absolute; top: calc(100% + 10px); right: 0;
      background: var(--white); border: var(--border-thick); border-radius: 18px;
      box-shadow: var(--shadow-lg); padding: 8px;
      min-width: 180px; z-index: 200;
    }
    .user-menu-wrap:hover .user-dropdown,
    .user-menu-wrap.open .user-dropdown { display: flex; flex-direction: column; gap: 4px; }
    .user-dropdown a, .user-dropdown button {
      display: block; width: 100%;
      padding: 9px 14px; border-radius: 12px;
      font-family: 'Fredoka', sans-serif; font-weight: 600; font-size: 0.92rem;
      text-decoration: none; color: var(--black); text-align: left;
      background: none; border: none; cursor: pointer;
      transition: background 0.1s;
    }
    .user-dropdown a:hover, .user-dropdown button:hover { background: var(--yellow-pale); }
    .user-dropdown .sign-out { color: #c0392b; }
    .user-dropdown .sep { border: none; border-top: var(--border); margin: 4px 0; }

    @media (max-width: 768px) {
      header { padding: 0 16px; position: relative; height: auto; min-height: 66px; flex-wrap: wrap; gap: 8px; padding: 8px 16px; }
      .menu-toggle { display: block; }
      nav {
        display: none; position: absolute; top: 66px; left: 0; right: 0;
        background: var(--green); border-bottom: var(--border);
        padding: 12px 0; flex-direction: column;
      }
      nav.show { display: flex; }
      nav ul { flex-direction: column; align-items: center; gap: 8px; padding: 6px 0; }
      .user-dropdown { right: auto; left: 0; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LOGIN MODAL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 500; display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none;
      transition: opacity 0.2s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: all; }

    .modal {
      background: var(--white);
      border: var(--border-thick); border-radius: 24px;
      box-shadow: var(--shadow-lg);
      padding: 36px 32px; width: 360px; max-width: 90vw;
      text-align: center; position: relative;
    }
    .modal-close {
      position: absolute; top: 14px; right: 18px;
      font-size: 1.5rem; cursor: pointer; color: #aaa; line-height: 1;
      background: none; border: none; font-family: inherit;
    }
    .modal-close:hover { color: var(--black); }
    .modal .modal-icon { font-size: 3rem; margin-bottom: 10px; }
    .modal h2 { font-weight: 700; font-size: 1.5rem; margin-bottom: 8px; }
    .modal p  { font-size: 0.97rem; color: #666; margin-bottom: 24px; line-height: 1.6; }

    .google-btn {
      display: inline-flex; align-items: center; gap: 10px; justify-content: center;
      width: 100%; padding: 13px 20px;
      background: var(--white); border: var(--border-thick); border-radius: 50px;
      font-family: 'Fredoka', sans-serif; font-weight: 700; font-size: 1rem;
      box-shadow: var(--shadow-md); cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s;
    }
    .google-btn:hover { transform: translate(-2px,-2px); box-shadow: 6px 6px 0 var(--black); }
    .google-btn svg { width: 20px; height: 20px; flex-shrink: 0; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BANNER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .logos-and-title {
      display: flex; justify-content: center; align-items: flex-end;
      background: var(--green-pale); border-bottom: var(--border-thick);
      position: relative; z-index: 1;
    }
    .logos-and-title .logo {
      width: 100%; height: auto; max-height: 160px; object-fit: contain; display: block;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN LAYOUT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .container {
      display: flex; gap: 24px;
      padding: 32px 60px 80px;
      max-width: 1400px; margin: 0 auto; width: 100%;
      position: relative; z-index: 1; flex: 1;
    }

    .video-section { flex: 2; display: flex; flex-direction: column; gap: 20px; }

    .video-card {
      background: var(--white); border: var(--border-thick); border-radius: 22px;
      box-shadow: var(--shadow-md); padding: 22px; overflow: hidden;
    }
    #video-title { font-weight: 700; font-size: 1.6rem; line-height: 1.3; margin-bottom: 6px; }
    #video-description { font-size: 1rem; color: #666; font-weight: 500; margin-bottom: 16px; }
    .video-card iframe {
      width: 100%; height: 500px;
      border: var(--border); border-radius: 14px; display: block;
    }

    /* â”€â”€ POST CONTENT â”€â”€ */
    .pcontainer {
      background: var(--white); border: var(--border-thick);
      border-radius: 22px; box-shadow: var(--shadow-md); padding: 24px;
    }
    .content-list {
      list-style: none; display: flex; flex-direction: column; gap: 16px;
    }
    .content-list li {
      display: flex; flex-direction: column;
      background: var(--bg); border: var(--border); border-radius: 18px;
      padding: 16px 20px; position: relative;
      opacity: 0; transform: translateY(20px);
      transition: opacity 0.4s ease, transform 0.4s ease, box-shadow 0.15s;
    }
    .content-list li.visible { opacity: 1; transform: translateY(0); }
    .content-list li:hover { box-shadow: var(--shadow-md); }
    .content-list li:nth-child(odd)  { background: var(--yellow-pale); }
    .content-list li:nth-child(even) { background: var(--green-pale); }

    .row { display: flex; align-items: center; gap: 14px; width: 100%; }
    .avatar-1 { width: 44px; height: 44px; border-radius: 50%; border: var(--border); background-size: cover; flex-shrink: 0; background-color: var(--yellow); }
    .user { font-size: 1rem; font-weight: 700; }

    .audio {
      position: absolute; top: 14px; right: 52px;
      font-size: 20px; cursor: pointer; transition: transform 0.15s;
    }
    .audio:hover { transform: scale(1.25); }

    .toggle-description {
      position: absolute; top: 10px; right: 14px;
      background: var(--green-pale); border: var(--border); border-radius: 50%;
      width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
      font-size: 13px; cursor: pointer; box-shadow: var(--shadow-sm);
      transition: transform 0.12s, box-shadow 0.12s;
    }
    .toggle-description:hover { transform: translate(-1px,-1px); box-shadow: 4px 4px 0 var(--black); }

    .content-list h2 { font-size: 1.35rem; font-weight: 700; line-height: 1.7; margin: 4px 0 0; cursor: default; }
    .content-list h2 span {
      cursor: pointer; display: inline;
      border-bottom: 2px solid transparent;
      transition: border-color 0.15s, color 0.15s, background 0.15s;
      border-radius: 4px; padding: 1px 2px;
    }
    .content-list h2 span:hover { color: var(--green-dark); border-color: var(--green); background: var(--green-pale); }

    .description {
      font-family: 'Quicksand', sans-serif;
      display: none; color: #555; font-size: 1rem; line-height: 1.65;
      margin-top: 10px; padding: 12px 14px;
      background: var(--white); border: var(--border); border-radius: 12px;
    }
    .content-image {
      max-width: 150px; height: auto; display: block;
      border: var(--border); border-radius: 10px;
    }
    .image-wrapper { display: inline-flex; align-items: center; justify-content: center; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       QUIZ SECTION
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .qcontainer {
      background: var(--white); border: var(--border-thick);
      border-radius: 22px; box-shadow: var(--shadow-md); padding: 28px 32px;
    }
    .qcontainer > h1 {
      font-weight: 700; font-size: 1.8rem; margin-bottom: 20px;
      display: inline-block;
      background: var(--yellow); border: var(--border); border-radius: 50px;
      padding: 8px 26px; box-shadow: var(--shadow-sm);
    }

    /* locked state */
    .quiz-locked {
      text-align: center; padding: 16px 0;
    }
    .quiz-locked p { color: #666; margin-bottom: 16px; font-size: 1rem; line-height: 1.6; }
    #quiz-login-btn {
      display: inline-flex; align-items: center; gap: 10px;
      background: var(--yellow); border: var(--border-thick); border-radius: 50px;
      padding: 12px 28px; font-family: 'Fredoka', sans-serif;
      font-weight: 700; font-size: 1.05rem; cursor: pointer;
      box-shadow: var(--shadow-md);
      transition: transform 0.12s, box-shadow 0.12s;
    }
    #quiz-login-btn:hover { transform: translate(-2px,-2px); box-shadow: 6px 6px 0 var(--black); }

    /* start button (logged in) */
    #start-container { margin-bottom: 12px; }
    #start-button {
      font-family: 'Fredoka', sans-serif; font-weight: 700; font-size: 1.3rem;
      background: var(--green); color: white;
      padding: 12px 36px; border: var(--border-thick); border-radius: 50px;
      box-shadow: var(--shadow-md); cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s;
    }
    #start-button:hover { transform: translate(-2px,-2px); box-shadow: 6px 6px 0 var(--black); }

    /* progress bar */
    .quiz-progress-wrap {
      background: #eee; border: var(--border); border-radius: 50px;
      height: 10px; margin: 0 0 20px; overflow: hidden;
      display: none;
    }
    .quiz-progress-fill {
      height: 100%; background: var(--green); border-radius: 50px;
      transition: width 0.3s ease;
    }
    .quiz-counter {
      font-size: 0.88rem; font-weight: 700; color: #888;
      margin-bottom: 10px; display: none;
    }

    /* â”€â”€ SENTENCE ZONE â”€â”€ */
    .sentence {
      margin: 20px 0 10px; font-size: 1.7rem; font-weight: 700;
      line-height: 2.6; display: none; flex-wrap: wrap;
      align-items: center; gap: 6px;
    }
    /* When sentence IS an image only â€” show it properly */
    .sentence img {
      display: inline-block; vertical-align: middle;
      max-width: 200px; max-height: 200px; height: auto; width: auto;
      border: var(--border); border-radius: 14px;
      box-shadow: var(--shadow-sm);
    }

    /* Empty blank â€” dashed slot */
    .blank {
      display: inline-flex; align-items: center; justify-content: center;
      min-width: 80px; min-height: 46px;
      border: 2.5px dashed #aaa; border-radius: 14px;
      margin: 0 4px; padding: 4px 14px;
      background: transparent; color: #aaa;
      font-family: 'Quicksand', sans-serif; font-weight: 800; font-size: 1.2rem;
      cursor: pointer; vertical-align: middle;
      transition: border-color 0.15s, background 0.15s, box-shadow 0.15s;
      user-select: none; position: relative;
    }
    .blank:not(.filled):not(.reveal-correct):not(.reveal-wrong)::after {
      content: 'ã€€'; /* em-space keeps height */
      color: transparent; pointer-events: none;
    }
    /* Filled blank â€” shows content, sky bg */
    .blank.filled {
      background: var(--sky);
      border: var(--border-thick); border-style: solid; border-radius: 14px;
      color: var(--black);
      box-shadow: var(--shadow-sm);
      cursor: pointer;
      padding: 4px 10px;
      min-height: 46px; height: auto; /* auto for image content */
    }
    .blank.filled:hover  { background: #a8dfff; box-shadow: var(--shadow-md); transform: translate(-1px,-2px); }
    /* Image inside filled blank */
    .blank.filled img {
      display: block; width: 70px; height: 70px;
      object-fit: cover; border-radius: 8px; border: none;
      pointer-events: none;
    }
    /* After reveal */
    .blank.reveal-correct {
      background: var(--green-light); border-color: var(--green-dark) !important;
      color: var(--green-dark); border-style: solid; cursor: default;
    }
    .blank.reveal-wrong {
      background: var(--pink-pale); border-color: #e53935 !important;
      color: #c0392b; border-style: solid; cursor: default;
    }
    .blank.reveal-correct img, .blank.reveal-wrong img {
      width: 70px; height: 70px; object-fit: cover; border-radius: 8px;
    }

    /* â”€â”€ OPTIONS ZONE â€” CSS Grid, tháº³ng lá» â”€â”€ */
    .options {
      margin: 16px 0 8px;
      display: none;   /* JS sets display:grid */
      grid-template-columns: repeat(9, 1fr);
      gap: 10px;
    }
    /* Image-heavy quiz: 2Ã—2 on desktop looks better â€” JS adds .options-img class */
    .options.options-img {
      grid-template-columns: repeat(4, 1fr);
    }

    /* Each cell = ghost (absolute) + btn â€” cell keeps size even when btn hidden */
    .word-cell {
      position: relative;
      display: flex;
      min-height: 50px; /* fallback height so cell never collapses */
    }

    /* Ghost placeholder â€” takes button's place when used */
    .word-ghost {
      position: absolute; inset: 0;
      visibility: hidden; pointer-events: none;
    }

    /* TEXT word â€” pill, Quicksand Bold */
    .word {
      font-family: 'Quicksand', sans-serif; font-weight: 800; font-size: 1.1rem;
      padding: 8px 8px;
      width: 100%;                    /* fill the grid cell */
      background: var(--pink); color: var(--black);
      border: var(--border-thick); border-radius: 40px;
      box-shadow: var(--shadow-sm); cursor: pointer;
      transition: transform 0.14s ease, box-shadow 0.14s ease, background 0.12s;
      user-select: none;
      display: flex; align-items: center; justify-content: center;
      text-align: center; line-height: 1.2;
      position: relative;
    }
    .word:hover:not(.used):not(.disabled) {
      transform: translate(-2px,-3px);
      box-shadow: 5px 5px 0 var(--black);
      background: var(--peach);
    }
    .word:active:not(.used):not(.disabled) { transform: translate(0,0); box-shadow: var(--shadow-sm); }

    /* IMAGE word â€” square card */
    .word.has-image {
      border-radius: 16px;
      padding: 6px;
      background: var(--white);
      aspect-ratio: 1;              /* keeps cell square */
    }
    .word.has-image img {
      display: block;
      width: 100%; height: 100%;
      object-fit: cover;
      border-radius: 10px;
      pointer-events: none;
    }

    /* Word hidden (placed in blank) */
    .word.used { visibility: hidden; pointer-events: none; }
    .word.disabled { opacity: 0.4; pointer-events: none; }
    .word.correct-reveal   { background: var(--green-light); border-color: var(--green-dark); }
    .word.incorrect-reveal { background: var(--pink-pale);   border-color: #e53935; }

    /* â”€â”€ MOBILE: 2 columns â”€â”€ */
    @media (max-width: 600px) {
      .options,
      .options.options-img { grid-template-columns: repeat(2, 1fr); }
    }

    /* result feedback (shown after Next) */
    .result { margin-top: 14px; font-size: 1.05rem; font-weight: 700; display: none; }
    .correct   { color: var(--green-dark); }
    .incorrect { color: #e53935; }

    /* next / finish buttons */
    #buttons { display: none; margin-top: 10px; }
    #buttons button {
      font-family: 'Fredoka', sans-serif; font-weight: 700; font-size: 1rem;
      padding: 10px 22px; border: var(--border-thick); border-radius: 50px;
      box-shadow: var(--shadow-sm); cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s; margin: 5px;
    }
    #buttons button:hover:not(:disabled) { transform: translate(-2px,-2px); box-shadow: 5px 5px 0 var(--black); }
    #buttons button.next   { background: var(--green); color: white; }
    #buttons button.finish { background: var(--yellow); color: var(--black); }
    #buttons button:disabled { opacity: 0.4; cursor: not-allowed; }

    /* â”€â”€ SCORE SUMMARY â”€â”€ */
    .score-summary {
      display: none; text-align: center; padding: 24px 0 8px;
    }
    .score-circle {
      width: 120px; height: 120px; border-radius: 50%;
      border: var(--border-thick); margin: 0 auto 16px;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      box-shadow: var(--shadow-lg);
      font-weight: 700;
    }
    .score-circle .score-num { font-size: 2.2rem; line-height: 1; }
    .score-circle .score-label { font-size: 0.85rem; color: #666; }
    .score-summary h2 { font-size: 1.4rem; margin-bottom: 8px; }
    .score-summary p  { color: #666; font-size: 0.97rem; margin-bottom: 18px; }

    .restart-btn {
      font-family: 'Fredoka', sans-serif; font-weight: 700; font-size: 1rem;
      background: var(--green); color: white;
      padding: 10px 28px; border: var(--border-thick); border-radius: 50px;
      box-shadow: var(--shadow-md); cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s;
    }
    .restart-btn:hover { transform: translate(-2px,-2px); box-shadow: 6px 6px 0 var(--black); }

    .hint-text { font-size: 0.9rem; color: #888; margin-top: 12px; border-top: var(--border); padding-top: 10px; }

    /* replay audio button */
    .replay-btn {
      font-family: 'Fredoka', sans-serif; font-weight: 700; font-size: 0.95rem;
      background: var(--sky-pale); border: var(--border); border-radius: 50px;
      padding: 8px 18px; box-shadow: var(--shadow-sm); cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s; margin: 5px;
    }
    .replay-btn:hover { transform: translate(-2px,-2px); box-shadow: 5px 5px 0 var(--black); }

    /* Modal auth error */
    .modal-error {
      background: var(--pink-pale); border: 2px solid #e53935; border-radius: 12px;
      padding: 10px 14px; font-size: 0.9rem; color: #c0392b;
      margin-top: 14px; display: none; text-align: left;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       WORD POPUP OVERLAY
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.55); z-index: 999;
    }
    .image-card {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: var(--white); border: var(--border-thick); border-radius: 22px;
      padding: 24px; box-shadow: var(--shadow-lg); z-index: 1000;
      width: 320px; text-align: center;
    }
    .image-card img { max-width: 100%; height: auto; border-radius: 10px; border: var(--border); }
    .image-card h3 { margin: 12px 0 6px; font-size: 1.2rem; }
    .image-card p  { font-size: 0.95rem; color: #666; }
    .image-card .close {
      position: absolute; top: 12px; right: 16px;
      cursor: pointer; font-size: 1.6rem; color: #aaa; line-height: 1;
      background: none; border: none; font-family: inherit;
    }
    .image-card .close:hover { color: var(--black); }
    #writer-container { display: flex; gap: 12px; justify-content: center; align-items: center; flex-wrap: wrap; }
    .image-card audio { width: 100%; margin-top: 10px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SIDEBAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .thumbnails-section {
      flex: 1; min-width: 260px; max-width: 320px;
      position: sticky; top: 86px; align-self: flex-start;
    }
    .sidebar-card {
      background: var(--white); border: var(--border-thick); border-radius: 22px;
      box-shadow: var(--shadow-md); padding: 18px;
      max-height: calc(100vh - 120px); overflow-y: auto;
    }
    .sidebar-card h3 {
      font-weight: 700; font-size: 1.15rem; margin-bottom: 16px;
      display: inline-block;
      background: var(--sky); border: var(--border); border-radius: 50px;
      padding: 5px 18px; box-shadow: var(--shadow-sm);
    }
    .thumbnail {
      display: flex; gap: 10px; margin-bottom: 14px; align-items: center;
      cursor: pointer; border: var(--border); border-radius: 14px;
      overflow: hidden; background: var(--bg);
      transition: transform 0.12s, box-shadow 0.12s;
    }
    .thumbnail:hover { transform: translate(-2px,-2px); box-shadow: 4px 4px 0 var(--black); }
    .thumbnail a { text-decoration: none; color: inherit; display: flex; gap: 10px; align-items: center; width: 100%; padding: 8px; }
    .thumbnail img { width: 90px; height: 56px; border-radius: 8px; border: var(--border); object-fit: cover; flex-shrink: 0; }
    .thumbnail h4 { font-size: 0.9rem; font-weight: 600; color: var(--black); margin: 0 0 3px; }
    .thumbnail p  { font-size: 0.78rem; color: #777; margin: 0; }

    /* â”€â”€ FIXED TAGS â”€â”€ */
    .buy-coffee, .new-words {
      position: fixed; right: 20px;
      background: var(--yellow); border: var(--border-thick);
      border-radius: 20px; padding: 10px 14px;
      box-shadow: var(--shadow-md); font-weight: 700; font-size: 0.9rem;
      z-index: 50; transition: transform 0.12s;
    }
    .buy-coffee { top: calc(50% - 70px); }
    .new-words  { top: 50%; transform: translateY(-50%); }
    .buy-coffee a, .new-words a { text-decoration: none; color: var(--black); }
    .buy-coffee:hover { transform: translate(-2px,-2px); }
    .new-words:hover  { transform: translateY(-50%) translate(-2px,-2px); }

    /* â”€â”€ FOOTER â”€â”€ */
    footer {
      background: #222; color: rgba(255,255,255,0.65);
      padding: 28px 50px; text-align: center; position: relative; z-index: 1;
    }
    footer .brand { font-weight: 700; color: var(--green-light); font-size: 1.3rem; margin-bottom: 6px; }
    footer p { font-size: 0.95rem; font-weight: 500; margin-bottom: 3px; }
    .social-icons { margin-top: 14px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
    .social-icons a {
      text-decoration: none; color: var(--black); font-weight: 600; font-size: 0.9rem;
      background: var(--green-light); border: var(--border); border-radius: 50px;
      padding: 5px 16px; box-shadow: var(--shadow-sm); transition: transform 0.12s;
    }
    .social-icons a:hover { transform: translate(-1px,-2px); }

    a { color: var(--green-dark); text-decoration: none; }
    a:hover { color: #e53935; }

    @media (max-width: 1024px) {
      .container { flex-direction: column; padding: 20px 20px 80px; }
      .thumbnails-section { max-width: 100%; width: 100%; position: static; }
      .sidebar-card { max-height: 400px; }
      .video-card iframe { height: 400px; }
    }
    @media (max-width: 768px) {
      .container { padding: 16px 16px 80px; }
      .video-card iframe { height: 280px; }
      .buy-coffee, .new-words { right: 10px; padding: 8px 10px; font-size: 0.8rem; }
      .buy-coffee { top: calc(50% - 55px); }
      footer { padding: 28px 20px; }
      .sentence { font-size: 1.3rem; }
      .word { font-size: 1.1rem; }
      .content-image { max-width: 80px; }
    }
    @media (max-width: 480px) {
      header h1 { font-size: 1.3rem; }
      .sentence { font-size: 1.1rem; }
      .word { font-size: 1rem; padding: 8px 14px; }
      .qcontainer { padding: 18px 16px; }
      .content-image { max-width: 65px; }
    }
  </style>
</head>
<body>

  <!-- â•â•â• HEADER â•â•â• -->
  <header>
    <h1><a href="index.html" class="homepage-link">CHINESE 60s</a></h1>
    <button class="menu-toggle" aria-label="Toggle navigation">&#9776;</button>
    <nav>
      <ul>
        <li><a href="about.html">About Us</a></li>
        <li><a href="courses.html">Courses</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="https://www.amazon.com/shop/studiorum60s" target="_blank">Amazon</a></li>

        <!-- AUTH AREA â€” toggled by JS -->
        <li id="auth-nav-item">
          <!-- State A: not logged in -->
          <button id="sign-in-btn" onclick="openLoginModal()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"><path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z" fill="#333"/></svg>
            Sign In
          </button>

          <!-- State B: logged in (hidden by default) -->
          <div class="user-menu-wrap" id="user-menu-wrap" style="display:none;">
            <div class="auth-pill" id="user-pill" onclick="toggleUserMenu()">
              <div class="avatar" id="nav-avatar">ğŸ‘¤</div>
              <span id="nav-username">User</span>
            </div>
            <div class="user-dropdown" id="user-dropdown">
              <a href="profile.html">ğŸ‘¤ My Profile</a>
              <hr class="sep">
              <button class="sign-out" onclick="signOut()">ğŸšª Sign Out</button>
            </div>
          </div>
        </li>
      </ul>
    </nav>
  </header>

  <!-- â•â•â• LOGIN MODAL â•â•â• -->
  <div class="modal-overlay" id="login-modal">
    <div class="modal">
      <button class="modal-close" onclick="closeLoginModal()">âœ•</button>
      <div class="modal-icon">ğŸ”</div>
      <h2>Sign in to continue</h2>
      <p>Sign in with your Google account to access the practice quiz and track your progress.</p>
      <button class="google-btn" id="google-signin-btn" onclick="doGoogleSignIn()">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
          <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
          <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
          <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/>
          <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
        </svg>
        <span id="signin-btn-text">Continue with Google</span>
      </button>
      <!-- Inline error message -->
      <div class="modal-error" id="modal-error"></div>
    </div>
  </div>

  <!-- â•â•â• BANNER â•â•â• -->
  <div class="logos-and-title">
    <img src="assets/banner.png" alt="Chinese 60s" class="logo">
  </div>

  <!-- â•â•â• MAIN LAYOUT â•â•â• -->
  <div class="container">

    <div class="video-section">

      <!-- Video Card -->
      <div class="video-card">
        <h1 id="video-title"></h1>
        <h3 id="video-description"></h3>
        <iframe id="video-iframe" src="" title="YouTube video player" allowfullscreen></iframe>
        <script src="js/fetch-video.js"></script>
      </div>

      <!-- Post Content -->
      <div class="pcontainer">
        <ul class="content-list" id="itemList"></ul>
      </div>
      <script src="js/posts-loader.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const p = new URLSearchParams(window.location.search);
          loadPosts(p.get('postStartId') || '21', p.get('postEndId') || '32', 'itemList');
        });
      </script>

      <!-- â•â•â• QUIZ SECTION â•â•â• -->
      <div class="qcontainer" id="quiz-container" data-start-id="24" data-end-id="38">
        <h1>Let's Practice! ğŸ¯</h1>

        <div id="quiz-unlocked">
          <!-- Start screen -->
          <div id="start-container">
            <button id="start-button">â–¶ Start Quiz</button>
          </div>

          <!-- Progress bar -->
          <div class="quiz-counter" id="quiz-counter"></div>
          <div class="quiz-progress-wrap" id="quiz-progress-wrap">
            <div class="quiz-progress-fill" id="quiz-progress-fill"></div>
          </div>

          <!-- Sentence with inline blanks -->
          <div class="sentence" id="sentence"></div>

          <!-- Word options (original pink pill style) -->
          <div class="options" id="options"></div>

          <!-- Feedback -->
          <div class="result" id="result"></div>

          <!-- Buttons -->
          <div id="buttons"></div>

          <!-- Score summary -->
          <div class="score-summary" id="score-summary">
            <div class="score-circle" id="score-circle">
              <span class="score-num" id="score-num">0/0</span>
              <span class="score-label">correct</span>
            </div>
            <h2 id="score-title">Quiz Complete!</h2>
            <p id="score-msg"></p>
            <button class="restart-btn" id="restart-btn">â–¶ Try Again</button>
          </div>
        </div>
      </div>

      <p class="hint-text">ğŸ’¡ Click on each Chinese character to see its meaning and pronunciation</p>
    </div>

    <!-- Sidebar -->
    <div class="thumbnails-section">
      <div class="sidebar-card">
        <h3>Other Videos</h3>
        <div id="thumbnails-container"></div>
      </div>
    </div>

  </div>

  

  <!-- Footer -->
  <footer>
    <p class="brand">CHINESE 60s</p>
    <p>Learn Mandarin through images and videos</p>
    <div class="social-icons">
      <a href="#">Facebook</a>
      <a href="#">YouTube</a>
      <a href="#">TikTok</a>
      <a href="#">Instagram</a>
    </div>
  </footer>

  <!-- quiz.js NOT loaded â€” logic fully inlined below -->

  <!-- Sidebar thumbnails -->
  <script>
    fetch('data/thumbnail.json')
      .then(r => r.json())
      .then(videos => {
        videos.sort((a, b) => b.id - a.id);
        const container = document.getElementById('thumbnails-container');
        videos.slice(0, 20).forEach(video => {
          const div = document.createElement('div');
          div.classList.add('thumbnail');
          div.innerHTML = `<a href="${video.htmlLink}"><img src="${video.thumbnail}" alt="${video.title}"><div><h4>${video.title}</h4><p>${video.description}</p></div></a>`;
          container.appendChild(div);
        });
      })
      .catch(err => console.error('Error loading JSON:', err));
  </script>

  <!-- Hamburger -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const menuToggle = document.querySelector('.menu-toggle');
      const nav = document.querySelector('nav');
      menuToggle.addEventListener('click', function () {
        nav.classList.toggle('show');
        menuToggle.innerHTML = nav.classList.contains('show') ? '&#10005;' : '&#9776;';
      });
    });
  </script>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AUTH â€” Firebase Google Sign-In
       âœ” Tries signInWithPopup first (fast, no page leave)
       âœ” Falls back to signInWithRedirect if popup blocked
       âœ” getRedirectResult() handles return after redirect
       âœ” window helpers exposed BEFORE auth resolves so
         onclick= attributes always work
       ğŸ“ Replace firebaseConfig values with your project's
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AUTH â€” Firebase Google Sign-In
       âœ” signInWithPopup (no page leave, no redirect issues)
       âœ” Inline error shown inside modal (no alert)
       âœ” window helpers stubbed immediately for onclick=
       ğŸ“ Replace firebaseConfig with your project values
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

  <!-- Stub helpers immediately so onclick= never throws ReferenceError -->
  <script>
    window.__currentUser   = null;

    window.openLoginModal  = function() {
      const m = document.getElementById('login-modal');
      m.classList.add('open');
      /* reset error & button state */
      const err = document.getElementById('modal-error');
      const txt = document.getElementById('signin-btn-text');
      if (err) { err.style.display = 'none'; err.textContent = ''; }
      if (txt) txt.textContent = 'Continue with Google';
      const btn = document.getElementById('google-signin-btn');
      if (btn) btn.disabled = false;
    };

    window.closeLoginModal = function() {
      document.getElementById('login-modal').classList.remove('open');
    };

    /* Temporary stub â€” replaced by module */
    window.doGoogleSignIn  = function() { openLoginModal(); };
    window.signOut         = function() {};
    window.toggleUserMenu  = function() {
      document.getElementById('user-menu-wrap').classList.toggle('open');
    };

    /* Close modal on backdrop click; close dropdown on outside click */
    document.addEventListener('click', function(e) {
      const modal = document.getElementById('login-modal');
      if (e.target === modal) closeLoginModal();
      const wrap = document.getElementById('user-menu-wrap');
      if (wrap && !wrap.contains(e.target) && !e.target.closest('#auth-nav-item')) {
        wrap.classList.remove('open');
      }
    });
  </script>

  <script type="module">
    import { initializeApp }  from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      signOut as fbSignOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ğŸ”§ PASTE YOUR FIREBASE CONFIG HERE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const firebaseConfig = {
      apiKey:            "AIzaSyAm-qQrpXKNdqFLITRAGCug7rkskGzyAkg",
      authDomain:        "chinese60s.firebaseapp.com",
      projectId:         "chinese60s",
      storageBucket:     "chinese60s.firebasestorage.app",
      messagingSenderId: "835657861121",
      appId:             "1:835657861121:web:f31727eb7ea3b876a5d800",
      measurementId:     "G-70NQ4PFTSN"
    };

    const app      = initializeApp(firebaseConfig);
    const auth     = getAuth(app);
    const provider = new GoogleAuthProvider();
    /* Always show account picker */
    provider.setCustomParameters({ prompt: 'select_account' });

    /* â”€â”€ Helper: show error inside modal â”€â”€ */
    function showModalError(msg) {
      const el = document.getElementById('modal-error');
      if (!el) return;
      el.textContent    = msg;
      el.style.display  = 'block';
      const btn = document.getElementById('google-signin-btn');
      const txt = document.getElementById('signin-btn-text');
      if (btn) btn.disabled = false;
      if (txt) txt.textContent = 'Continue with Google';
    }

    function setSignInLoading(loading) {
      const btn = document.getElementById('google-signin-btn');
      const txt = document.getElementById('signin-btn-text');
      if (!btn || !txt) return;
      btn.disabled     = loading;
      txt.textContent  = loading ? 'Opening Googleâ€¦' : 'Continue with Google';
    }

    /* â”€â”€ Google Sign-In with Popup â”€â”€ */
    window.doGoogleSignIn = async function() {
      /* Clear previous error */
      const errEl = document.getElementById('modal-error');
      if (errEl) { errEl.style.display = 'none'; errEl.textContent = ''; }

      setSignInLoading(true);
      try {
        await signInWithPopup(auth, provider);
        /* onAuthStateChanged will fire and update UI */
        closeLoginModal();
      } catch (err) {
        setSignInLoading(false);
        console.error('Sign-in error:', err.code, err.message);

        /* Map common Firebase error codes to friendly messages */
        const msgs = {
          'auth/popup-blocked':
            'ğŸš« Popup was blocked. Please allow popups for this site in your browser settings, then try again.',
          'auth/popup-closed-by-user':
            'âŒ Sign-in window was closed. Please try again.',
          'auth/cancelled-popup-request':
            'âŒ Sign-in was cancelled. Please try again.',
          'auth/network-request-failed':
            'ğŸŒ Network error. Check your internet connection and try again.',
          'auth/invalid-api-key':
            'âš™ï¸ Firebase configuration error. Please contact the site admin.',
          'auth/operation-not-allowed':
            'âš™ï¸ Google sign-in is not enabled. Please contact the site admin.',
          'auth/unauthorized-domain':
            'âš™ï¸ This domain is not authorised for sign-in. Please contact the site admin.',
          'auth/user-disabled':
            'ğŸš« This account has been disabled.',
        };
        showModalError(msgs[err.code] || `Sign-in failed: ${err.message}`);
      }
    };

    /* â”€â”€ Sign Out â”€â”€ */
    window.signOut = async function() {
      try { await fbSignOut(auth); } catch(e) { console.error('Sign-out error:', e); }
    };

    /* â”€â”€ Update nav UI on auth state change â”€â”€ */
    onAuthStateChanged(auth, function(user) {
      const signInBtn    = document.getElementById('sign-in-btn');
      const userMenuWrap = document.getElementById('user-menu-wrap');
      const navUsername  = document.getElementById('nav-username');
      const navAvatar    = document.getElementById('nav-avatar');

      if (user) {
        if (signInBtn)    signInBtn.style.display    = 'none';
        if (userMenuWrap) userMenuWrap.style.display = 'block';
        if (navUsername)  navUsername.textContent    = user.displayName?.split(' ')[0] || 'User';
        if (navAvatar)    navAvatar.innerHTML        = user.photoURL
          ? `<img src="${user.photoURL}" alt="avatar" referrerpolicy="no-referrer">`
          : `<span>${(user.displayName?.[0] || '?').toUpperCase()}</span>`;
        window.__currentUser = user;
      } else {
        if (signInBtn)    signInBtn.style.display    = 'inline-flex';
        if (userMenuWrap) userMenuWrap.style.display = 'none';
        window.__currentUser = null;
      }
    });
  </script>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       QUIZ LOGIC
       Data shape: quiz.json â†’ { questions:[{ id, sentence, blanks:[{answer}], words:[], audio? }] }

       UX:
       âœ” Auth gate on Start
       âœ” Sentence shown with ___ as dashed pill blanks (original style)
       âœ” Options below as pink pill buttons â€” text or image
       âœ” Click option â†’ hides (ghost), content appears in blank inline
       âœ” Click filled blank â†’ option returns, blank resets
       âœ” All blanks filled â†’ Next enables
       âœ” Next â†’ reveal green/red on blanks + options, show feedback
       âœ” No Retry; final score summary
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
  (function () {

    /* â•â• HELPERS â•â• */
    function isImg(s) { return /\.(jpe?g|png|gif|bmp|webp|svg)$/i.test(String(s || '')); }

    /* Inner HTML for a word â€” image or text */
    function wordHTML(w) {
      if (isImg(w)) return `<img src="${w}" alt="">`;
      return String(w);
    }

    /* â•â• STATE â•â• */
    let questions    = [];
    let curIdx       = 0;
    let scoreCorrect = 0;
    let revealed     = false;
    /*
      slots[i] = null | { optBtn, ghostEl, word }
      parallel to blanks[] of current question
    */
    let slots = [];

    const clickAudio     = new Audio('assets/click.mp3');
    const correctAudio   = new Audio('assets/correct.mp3');
    const incorrectAudio = new Audio('assets/incorrect.mp3');
    const victoryAudio   = new Audio('assets/victory.mp3');
    let   qAudio         = null;

    /* â•â• DOM â•â• */
    const startCont    = document.getElementById('start-container');
    const startBtn     = document.getElementById('start-button');
    const sentenceEl   = document.getElementById('sentence');
    const optionsEl    = document.getElementById('options');
    const resultEl     = document.getElementById('result');
    const buttonsEl    = document.getElementById('buttons');
    const progWrap     = document.getElementById('quiz-progress-wrap');
    const progFill     = document.getElementById('quiz-progress-fill');
    const counterEl    = document.getElementById('quiz-counter');
    const summaryEl    = document.getElementById('score-summary');
    const scoreNumEl   = document.getElementById('score-num');
    const scoreTitleEl = document.getElementById('score-title');
    const scoreMsgEl   = document.getElementById('score-msg');
    const scoreCircle  = document.getElementById('score-circle');
    const restartBtn   = document.getElementById('restart-btn');

    /* â•â• LOAD JSON â•â• */
    async function loadQ(startId, endId) {
      try {
        const r    = await fetch('data/quiz.json');
        const json = await r.json();
        const raw  = Array.isArray(json) ? json : (json.questions || []);
        return raw.filter(q => q.id >= startId && q.id <= endId);
      } catch(e) {
        console.warn('quiz.json failed, using demo:', e);
        return [
          { id:1, sentence:'æˆ‘___è‹¹æœã€‚', blanks:[{answer:'å–œæ¬¢'}], words:['å–œæ¬¢','ä¸æ˜¯','å¾ˆå¥½','å»'] },
          { id:2, sentence:'ä»–___è€å¸ˆã€‚', blanks:[{answer:'æ˜¯'}],   words:['æ˜¯','æœ‰','åœ¨','å¾ˆ'] },
          { id:3, sentence:'æˆ‘ä»¬___ä¸€èµ·___å­¦ä¹ ã€‚', blanks:[{answer:'å¯ä»¥'},{answer:'å¥½å¥½'}], words:['å¯ä»¥','ä¸å¥½','å¥½å¥½','å¾ˆå¤§'] }
        ];
      }
    }

    /* â•â• START â•â• */
    startBtn.addEventListener('click', async () => {
      if (!window.__currentUser) { openLoginModal(); return; }

      const qc   = document.getElementById('quiz-container');
      const p    = new URLSearchParams(window.location.search);
      const sId  = parseInt(p.get('quizStartId')) || parseInt(qc.dataset.startId) || 1;
      const eId  = parseInt(p.get('quizEndId'))   || parseInt(qc.dataset.endId)   || 10;

      questions    = await loadQ(sId, eId);
      curIdx       = 0;
      scoreCorrect = 0;

      startCont.style.display  = 'none';
      progWrap.style.display   = 'block';
      counterEl.style.display  = 'block';
      summaryEl.style.display  = 'none';
      showQ();
    });

    /* â•â• SHOW QUESTION â•â• */
    function showQ() {
      if (curIdx >= questions.length) { showSummary(); return; }

      const q      = questions[curIdx];
      const blanks = q.blanks || [];
      revealed     = false;
      slots        = blanks.map(() => null);

      /* Progress */
      progFill.style.width  = (curIdx / questions.length * 100) + '%';
      counterEl.textContent = `Question ${curIdx + 1} of ${questions.length}`;

      /* â”€â”€ Build sentence with inline blank pills â”€â”€ */
      let sentRaw = q.sentence || '';
      /* If sentence is an array (mixed tokens), join them */
      if (Array.isArray(sentRaw)) {
        sentRaw = sentRaw.map(tok => isImg(tok) ? `<img src="${tok}" alt="">` : String(tok)).join('');
      } else {
        /* Replace any image paths in text with img tags */
        sentRaw = String(sentRaw).replace(/([\S]+\.(?:jpe?g|png|gif|bmp|webp|svg))/gi,
          '<img src="$1" alt="">');
      }

      let bi = 0;
      const sentHTML = sentRaw.replace(/___/g, () => {
        const idx = bi++;
        return `<span class="blank" data-bi="${idx}"></span>`;
      });
      sentenceEl.innerHTML = sentHTML;
      /* Use flex so images + text + blanks all align nicely */
      sentenceEl.style.display = 'flex';

      /* Attach click to each blank */
      sentenceEl.querySelectorAll('.blank').forEach(blankEl => {
        blankEl.addEventListener('click', () => handleBlankClick(blankEl));
      });

      /* â”€â”€ Build options (shuffled) â”€â”€ */
      const words = [...(q.words || [])].sort(() => Math.random() - 0.5);
      optionsEl.innerHTML = '';

      /* Detect if this question is image-based (majority of words are images) */
      const imgCount = words.filter(w => isImg(w)).length;
      const isImgQ   = imgCount > words.length / 2;

      /* Show as grid */
      optionsEl.style.display = 'grid';
      optionsEl.classList.toggle('options-img', isImgQ);

      words.forEach(word => {
        const hasImg = isImg(word);

        /* Cell wrapper â€” ghost + btn */
        const cell = document.createElement('div');
        cell.className = 'word-cell';

        /* Ghost â€” fills cell space when word is used */
        const ghost = document.createElement('span');
        ghost.className = 'word-ghost';

        const btn = document.createElement('button');
        btn.className    = 'word';
        btn.dataset.word = String(word);
        btn.innerHTML    = wordHTML(word);
        if (hasImg) btn.classList.add('has-image');

        btn.addEventListener('click', () => handleWordClick(btn, ghost));

        cell.appendChild(ghost);
        cell.appendChild(btn);
        optionsEl.appendChild(cell);

        /* Size ghost after btn renders */
        requestAnimationFrame(() => {
          ghost.style.width  = btn.offsetWidth  + 'px';
          ghost.style.height = btn.offsetHeight + 'px';
        });
      });

      /* â”€â”€ Reset feedback & buttons â”€â”€ */
      resultEl.style.display  = 'none';
      resultEl.textContent    = '';
      resultEl.className      = 'result';

      buttonsEl.innerHTML     = '';
      buttonsEl.style.display = 'block';

      /* Audio replay */
      if (q.audio) {
        if (qAudio) { qAudio.pause(); }
        qAudio = new Audio(q.audio);
        qAudio.play().catch(() => {});
        const rb = document.createElement('button');
        rb.className   = 'replay-btn';
        rb.textContent = 'ğŸ”Š Replay';
        rb.addEventListener('click', () => { qAudio.currentTime = 0; qAudio.play().catch(() => {}); });
        buttonsEl.appendChild(rb);
      }

      /* Next/Finish â€” disabled until all blanks filled */
      const isLast    = curIdx === questions.length - 1;
      const actionBtn = document.createElement('button');
      actionBtn.id          = 'action-btn';
      actionBtn.textContent = isLast ? 'Finish âœ“' : 'Next â†’';
      actionBtn.className   = isLast ? 'finish' : 'next';
      actionBtn.disabled    = true;
      actionBtn.addEventListener('click', () => reveal(q));
      buttonsEl.appendChild(actionBtn);
    }

    /* â•â• CLICK OPTION WORD â†’ fill blank â•â• */
    function handleWordClick(btn, ghost) {
      if (revealed || btn.classList.contains('used')) return;

      /* find first empty slot */
      const emptyBi = slots.findIndex(s => s === null);
      if (emptyBi === -1) return;

      play(clickAudio);

      /* Ghost is position:absolute inset:0 â€” just make it visible to block clicks */
      btn.classList.add('used');

      /* Fill blank */
      const blankEl = sentenceEl.querySelector(`[data-bi="${emptyBi}"]`);
      if (!blankEl) return;
      blankEl.innerHTML = wordHTML(btn.dataset.word);
      blankEl.classList.add('filled');

      slots[emptyBi] = { optBtn: btn, ghostEl: ghost, word: btn.dataset.word };
      checkAllFilled();
    }

    /* â•â• CLICK FILLED BLANK â†’ return word â•â• */
    function handleBlankClick(blankEl) {
      if (revealed) return;
      const bi   = parseInt(blankEl.dataset.bi);
      const slot = slots[bi];
      if (!slot) return;

      play(clickAudio);

      /* Restore word button */
      slot.optBtn.classList.remove('used');

      /* Clear blank â€” keep data-bi for re-attach */
      blankEl.innerHTML = '';
      blankEl.className = 'blank';
      blankEl.setAttribute('data-bi', String(bi));

      slots[bi] = null;
      checkAllFilled();

      /* Re-attach click listener */
      blankEl.addEventListener('click', () => handleBlankClick(blankEl));
    }

    function checkAllFilled() {
      const btn = document.getElementById('action-btn');
      if (btn) btn.disabled = slots.some(s => s === null);
    }

    /* â•â• REVEAL (Next clicked) â•â• */
    function reveal(q) {
      if (revealed || slots.some(s => s === null)) return;
      revealed = true;

      const blanks = q.blanks || [];
      let allOk = true;
      blanks.forEach((b, i) => {
        if (!slots[i] || String(slots[i].word) !== String(b.answer)) allOk = false;
      });
      if (allOk) scoreCorrect++;

      /* Colour blanks */
      blanks.forEach((b, i) => {
        const blankEl = sentenceEl.querySelector(`[data-bi="${i}"]`);
        if (!blankEl) return;
        const ok = slots[i] && String(slots[i].word) === String(b.answer);
        blankEl.classList.add(ok ? 'reveal-correct' : 'reveal-wrong');
        blankEl.style.cursor = 'default';
        if (!ok && !isImg(b.answer)) {
          /* Append correct text answer hint */
          const hint = document.createElement('small');
          hint.textContent = ` (${b.answer})`;
          hint.style.cssText = 'font-size:0.65em;opacity:0.75;margin-left:4px;';
          blankEl.appendChild(hint);
        }
      });

      /* Colour option buttons */
      optionsEl.querySelectorAll('.word').forEach(btn => {
        btn.disabled = true;
        btn.style.cursor = 'default';
        const isCorrect = blanks.some(b => String(b.answer) === btn.dataset.word);
        const wasUsed   = slots.some(s => s && s.optBtn === btn);
        if (wasUsed && isCorrect)  btn.classList.add('correct-reveal');
        if (wasUsed && !isCorrect) btn.classList.add('incorrect-reveal');
        if (!wasUsed && isCorrect) btn.classList.add('correct-reveal');
      });

      /* Feedback */
      if (allOk) {
        play(correctAudio);
        resultEl.textContent = 'âœ… Correct!';
        resultEl.className   = 'result correct';
      } else {
        play(incorrectAudio);
        resultEl.textContent = `âŒ Answer: ${blanks.map(b => b.answer).join(' / ')}`;
        resultEl.className   = 'result incorrect';
      }
      resultEl.style.display = 'block';

      /* Swap action button to Continue */
      const actionBtn = document.getElementById('action-btn');
      if (actionBtn) {
        const isLast = curIdx === questions.length - 1;
        const fresh  = actionBtn.cloneNode(false);
        fresh.textContent = isLast ? 'See Results ğŸ†' : 'Continue â†’';
        fresh.className   = isLast ? 'finish' : 'next';
        fresh.disabled    = false;
        fresh.addEventListener('click', () => { curIdx++; showQ(); });
        actionBtn.replaceWith(fresh);
      }
    }

    /* â•â• SUMMARY â•â• */
    function showSummary() {
      sentenceEl.style.display  = 'none';
      optionsEl.style.display   = 'none';
      resultEl.style.display    = 'none';
      buttonsEl.style.display   = 'none';
      progWrap.style.display    = 'none';
      counterEl.style.display   = 'none';
      play(victoryAudio);

      const total = questions.length;
      const pct   = total ? Math.round(scoreCorrect / total * 100) : 0;
      progFill.style.width   = '100%';
      scoreNumEl.textContent = `${scoreCorrect}/${total}`;

      if (pct >= 80) {
        scoreCircle.style.background  = 'var(--green-pale)';
        scoreCircle.style.borderColor = 'var(--green)';
        scoreTitleEl.textContent = 'ğŸ‰ Excellent!';
        scoreMsgEl.textContent   = `You got ${scoreCorrect}/${total} correct (${pct}%). Outstanding!`;
      } else if (pct >= 50) {
        scoreCircle.style.background  = 'var(--yellow-pale)';
        scoreCircle.style.borderColor = 'var(--yellow)';
        scoreTitleEl.textContent = 'ğŸ‘ Good effort!';
        scoreMsgEl.textContent   = `You got ${scoreCorrect}/${total} correct (${pct}%). Keep it up!`;
      } else {
        scoreCircle.style.background  = 'var(--pink-pale)';
        scoreCircle.style.borderColor = 'var(--pink)';
        scoreTitleEl.textContent = 'ğŸ’ª Keep going!';
        scoreMsgEl.textContent   = `You got ${scoreCorrect}/${total} correct (${pct}%). Try again!`;
      }
      summaryEl.style.display = 'block';
    }

    /* â•â• RESTART â•â• */
    restartBtn.addEventListener('click', () => {
      summaryEl.style.display  = 'none';
      startCont.style.display  = 'block';
      progWrap.style.display   = 'none';
      counterEl.style.display  = 'none';
      progFill.style.width     = '0%';
      sentenceEl.style.display = 'none';
      optionsEl.style.display  = 'none';
      buttonsEl.style.display  = 'none';
      resultEl.style.display   = 'none';
    });

    function play(audio) {
      try { audio.currentTime = 0; audio.play().catch(() => {}); } catch(e) {}
    }

  })();
  </script>

</body>
</html>


