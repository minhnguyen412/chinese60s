<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Post Page â€” Chinese60s</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3235921032748480" crossorigin="anonymous"></script>
  <style>
    :root {
      --black: #222;
      --green: #7cb83e;
      --green-dark: #5a8f27;
      --green-light: #d8f0a0;
      --green-pale: #f2fde0;
      --yellow: #ffd84d;
      --yellow-pale: #fffbe6;
      --peach: #ffb89a;
      --peach-pale: #fff3ee;
      --sky: #72c8f0;
      --sky-pale: #eaf8ff;
      --lavender: #c5b0f8;
      --lavender-pale: #f3f0ff;
      --pink: #ffadc5;
      --pink-pale: #fff2f6;
      --white: #fff;
      --bg: #fffef5;
      --shadow-sm: 3px 3px 0 var(--black);
      --shadow-md: 4px 4px 0 var(--black);
      --shadow-lg: 6px 6px 0 var(--black);
      --border: 2.5px solid var(--black);
      --border-thick: 3px solid var(--black);
    }

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }

    body {
      font-family: 'Fredoka', sans-serif;
      font-weight: 500;
      background: var(--bg);
      color: var(--black);
      overflow-x: hidden;
      min-height: 100vh;
      display: flex; flex-direction: column;
    }
    body::before {
      content: '';
      position: fixed; inset: 0;
      background-image: radial-gradient(circle, rgba(0,0,0,0.045) 1px, transparent 1px);
      background-size: 22px 22px;
      pointer-events: none; z-index: 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    header {
      background: var(--green);
      border-bottom: var(--border-thick);
      padding: 0 50px; height: 66px;
      display: flex; justify-content: space-between; align-items: center;
      position: sticky; top: 0; z-index: 100;
    }
    header h1 {
      font-weight: 700; font-size: 1.7rem; color: white;
      letter-spacing: 0.04em; text-shadow: 2px 2px 0 rgba(0,0,0,0.25);
    }
    .homepage-link { text-decoration: none; color: inherit; }
    .menu-toggle { display: none; font-size: 24px; background: none; border: none; color: white; cursor: pointer; }

    nav { display: flex; align-items: center; }
    nav ul { list-style: none; display: flex; gap: 8px; align-items: center; }
    nav ul li a {
      text-decoration: none; color: var(--black);
      font-weight: 600; font-size: 0.95rem;
      background: var(--white); border: var(--border); border-radius: 50px;
      padding: 6px 16px; display: inline-block;
      box-shadow: var(--shadow-sm); transition: transform 0.12s, box-shadow 0.12s;
    }
    nav ul li a:hover { transform: translate(-2px,-2px); box-shadow: 5px 5px 0 var(--black); }

    /* â”€â”€ AUTH PILL in nav â”€â”€ */
    .auth-pill {
      display: flex; align-items: center; gap: 8px;
      background: var(--white); border: var(--border); border-radius: 50px;
      padding: 5px 14px 5px 6px;
      box-shadow: var(--shadow-sm);
      cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s;
      font-weight: 600; font-size: 0.9rem; color: var(--black);
      text-decoration: none; white-space: nowrap;
    }
    .auth-pill:hover { transform: translate(-2px,-2px); box-shadow: 5px 5px 0 var(--black); }
    .auth-pill .avatar {
      width: 28px; height: 28px; border-radius: 50%;
      border: 2px solid var(--black); object-fit: cover;
      background: var(--green-light);
      display: flex; align-items: center; justify-content: center;
      font-size: 0.85rem; font-weight: 700; overflow: hidden;
      flex-shrink: 0;
    }
    .auth-pill .avatar img { width: 100%; height: 100%; object-fit: cover; }

    /* sign-in pill (no avatar) */
    #sign-in-btn {
      background: var(--yellow); border: var(--border); border-radius: 50px;
      padding: 6px 18px; font-weight: 700; font-size: 0.9rem;
      box-shadow: var(--shadow-sm); cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s;
      display: flex; align-items: center; gap: 6px;
      font-family: 'Fredoka', sans-serif;
    }
    #sign-in-btn:hover { transform: translate(-2px,-2px); box-shadow: 5px 5px 0 var(--black); }

    /* user dropdown */
    .user-menu-wrap { position: relative; }
    .user-dropdown {
      display: none;
      position: absolute; top: calc(100% + 10px); right: 0;
      background: var(--white); border: var(--border-thick); border-radius: 18px;
      box-shadow: var(--shadow-lg); padding: 8px;
      min-width: 180px; z-index: 200;
    }
    .user-menu-wrap:hover .user-dropdown,
    .user-menu-wrap.open .user-dropdown { display: flex; flex-direction: column; gap: 4px; }
    .user-dropdown a, .user-dropdown button {
      display: block; width: 100%;
      padding: 9px 14px; border-radius: 12px;
      font-family: 'Fredoka', sans-serif; font-weight: 600; font-size: 0.92rem;
      text-decoration: none; color: var(--black); text-align: left;
      background: none; border: none; cursor: pointer;
      transition: background 0.1s;
    }
    .user-dropdown a:hover, .user-dropdown button:hover { background: var(--yellow-pale); }
    .user-dropdown .sign-out { color: #c0392b; }
    .user-dropdown .sep { border: none; border-top: var(--border); margin: 4px 0; }

    @media (max-width: 768px) {
      header { padding: 0 16px; position: relative; height: auto; min-height: 66px; flex-wrap: wrap; gap: 8px; padding: 8px 16px; }
      .menu-toggle { display: block; }
      nav {
        display: none; position: absolute; top: 66px; left: 0; right: 0;
        background: var(--green); border-bottom: var(--border);
        padding: 12px 0; flex-direction: column;
      }
      nav.show { display: flex; }
      nav ul { flex-direction: column; align-items: center; gap: 8px; padding: 6px 0; }
      .user-dropdown { right: auto; left: 0; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LOGIN MODAL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 500; display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none;
      transition: opacity 0.2s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: all; }

    .modal {
      background: var(--white);
      border: var(--border-thick); border-radius: 24px;
      box-shadow: var(--shadow-lg);
      padding: 36px 32px; width: 360px; max-width: 90vw;
      text-align: center; position: relative;
    }
    .modal-close {
      position: absolute; top: 14px; right: 18px;
      font-size: 1.5rem; cursor: pointer; color: #aaa; line-height: 1;
      background: none; border: none; font-family: inherit;
    }
    .modal-close:hover { color: var(--black); }
    .modal .modal-icon { font-size: 3rem; margin-bottom: 10px; }
    .modal h2 { font-weight: 700; font-size: 1.5rem; margin-bottom: 8px; }
    .modal p  { font-size: 0.97rem; color: #666; margin-bottom: 24px; line-height: 1.6; }

    .google-btn {
      display: inline-flex; align-items: center; gap: 10px; justify-content: center;
      width: 100%; padding: 13px 20px;
      background: var(--white); border: var(--border-thick); border-radius: 50px;
      font-family: 'Fredoka', sans-serif; font-weight: 700; font-size: 1rem;
      box-shadow: var(--shadow-md); cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s;
    }
    .google-btn:hover { transform: translate(-2px,-2px); box-shadow: 6px 6px 0 var(--black); }
    .google-btn svg { width: 20px; height: 20px; flex-shrink: 0; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BANNER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .logos-and-title {
      display: flex; justify-content: center; align-items: flex-end;
      background: var(--green-pale); border-bottom: var(--border-thick);
      position: relative; z-index: 1;
    }
    .logos-and-title .logo {
      width: 100%; height: auto; max-height: 160px; object-fit: contain; display: block;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN LAYOUT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .container {
      display: flex; gap: 24px;
      padding: 32px 60px 80px;
      max-width: 1400px; margin: 0 auto; width: 100%;
      position: relative; z-index: 1; flex: 1;
    }

    .video-section { flex: 2; display: flex; flex-direction: column; gap: 20px; }

    .video-card {
      background: var(--white); border: var(--border-thick); border-radius: 22px;
      box-shadow: var(--shadow-md); padding: 22px; overflow: hidden;
    }
    #video-title { font-weight: 700; font-size: 1.6rem; line-height: 1.3; margin-bottom: 6px; }
    #video-description { font-size: 1rem; color: #666; font-weight: 500; margin-bottom: 16px; }
    .video-card iframe {
      width: 100%; height: 500px;
      border: var(--border); border-radius: 14px; display: block;
    }

    /* â”€â”€ POST CONTENT â”€â”€ */
    .pcontainer {
      background: var(--white); border: var(--border-thick);
      border-radius: 22px; box-shadow: var(--shadow-md); padding: 24px;
    }
    .content-list {
      list-style: none; display: flex; flex-direction: column; gap: 16px;
    }
    .content-list li {
      display: flex; flex-direction: column;
      background: var(--bg); border: var(--border); border-radius: 18px;
      padding: 16px 20px; position: relative;
      opacity: 0; transform: translateY(20px);
      transition: opacity 0.4s ease, transform 0.4s ease, box-shadow 0.15s;
    }
    .content-list li.visible { opacity: 1; transform: translateY(0); }
    .content-list li:hover { box-shadow: var(--shadow-md); }
    .content-list li:nth-child(odd)  { background: var(--yellow-pale); }
    .content-list li:nth-child(even) { background: var(--green-pale); }

    .row { display: flex; align-items: center; gap: 14px; width: 100%; }
    .avatar-1 { width: 44px; height: 44px; border-radius: 50%; border: var(--border); background-size: cover; flex-shrink: 0; background-color: var(--yellow); }
    .user { font-size: 1rem; font-weight: 700; }

    .audio {
      position: absolute; top: 14px; right: 52px;
      font-size: 20px; cursor: pointer; transition: transform 0.15s;
    }
    .audio:hover { transform: scale(1.25); }

    .toggle-description {
      position: absolute; top: 10px; right: 14px;
      background: var(--green-pale); border: var(--border); border-radius: 50%;
      width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
      font-size: 13px; cursor: pointer; box-shadow: var(--shadow-sm);
      transition: transform 0.12s, box-shadow 0.12s;
    }
    .toggle-description:hover { transform: translate(-1px,-1px); box-shadow: 4px 4px 0 var(--black); }

    .content-list h2 { font-size: 1.35rem; font-weight: 700; line-height: 1.7; margin: 4px 0 0; cursor: default; }
    .content-list h2 span {
      cursor: pointer; display: inline;
      border-bottom: 2px solid transparent;
      transition: border-color 0.15s, color 0.15s, background 0.15s;
      border-radius: 4px; padding: 1px 2px;
    }
    .content-list h2 span:hover { color: var(--green-dark); border-color: var(--green); background: var(--green-pale); }

    .description {
      font-family: 'Quicksand', sans-serif;
      display: none; color: #555; font-size: 1rem; line-height: 1.65;
      margin-top: 10px; padding: 12px 14px;
      background: var(--white); border: var(--border); border-radius: 12px;
    }
    .content-image {
      max-width: 150px; height: auto; display: block;
      border: var(--border); border-radius: 10px;
    }
    .image-wrapper { display: inline-flex; align-items: center; justify-content: center; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       QUIZ SECTION
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .qcontainer {
      background: var(--white); border: var(--border-thick);
      border-radius: 22px; box-shadow: var(--shadow-md); padding: 28px 32px;
    }
    .qcontainer > h1 {
      font-weight: 700; font-size: 1.8rem; margin-bottom: 20px;
      display: inline-block;
      background: var(--yellow); border: var(--border); border-radius: 50px;
      padding: 8px 26px; box-shadow: var(--shadow-sm);
    }

    /* locked state */
    .quiz-locked {
      text-align: center; padding: 16px 0;
    }
    .quiz-locked p { color: #666; margin-bottom: 16px; font-size: 1rem; line-height: 1.6; }
    #quiz-login-btn {
      display: inline-flex; align-items: center; gap: 10px;
      background: var(--yellow); border: var(--border-thick); border-radius: 50px;
      padding: 12px 28px; font-family: 'Fredoka', sans-serif;
      font-weight: 700; font-size: 1.05rem; cursor: pointer;
      box-shadow: var(--shadow-md);
      transition: transform 0.12s, box-shadow 0.12s;
    }
    #quiz-login-btn:hover { transform: translate(-2px,-2px); box-shadow: 6px 6px 0 var(--black); }

    /* start button (logged in) */
    #start-container { margin-bottom: 12px; }
    #start-button {
      font-family: 'Fredoka', sans-serif; font-weight: 700; font-size: 1.3rem;
      background: var(--green); color: white;
      padding: 12px 36px; border: var(--border-thick); border-radius: 50px;
      box-shadow: var(--shadow-md); cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s;
    }
    #start-button:hover { transform: translate(-2px,-2px); box-shadow: 6px 6px 0 var(--black); }

    /* progress bar */
    .quiz-progress-wrap {
      background: #eee; border: var(--border); border-radius: 50px;
      height: 10px; margin: 0 0 20px; overflow: hidden;
      display: none;
    }
    .quiz-progress-fill {
      height: 100%; background: var(--green); border-radius: 50px;
      transition: width 0.3s ease;
    }
    .quiz-counter {
      font-size: 0.88rem; font-weight: 700; color: #888;
      margin-bottom: 10px; display: none;
    }

    /* sentence */
    .sentence {
      margin: 20px 0; font-size: 1.8rem; font-weight: 700; line-height: 1.6; display: none;
    }
    .blank {
      display: inline-block; width: 100px;
      border-bottom: 3px solid var(--black);
      text-align: center; margin: 0 5px; color: #888;
    }
    .blank.filled { color: var(--green-dark); border-color: var(--green); }

    /* options */
    .options { margin: 16px 0; display: none; }
    .word {
      font-family: 'Fredoka', sans-serif; font-weight: 600; font-size: 1.3rem;
      padding: 10px 20px; margin: 5px;
      background: var(--pink); color: var(--black);
      border: var(--border-thick); border-radius: 50px;
      box-shadow: var(--shadow-sm); cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s, background 0.12s;
      user-select: none;
    }
    .word:hover:not(.selected):not(.disabled) { transform: translate(-2px,-2px); box-shadow: 5px 5px 0 var(--black); background: var(--peach); }
    .word.selected { background: var(--sky); box-shadow: var(--shadow-md); transform: translate(-1px,-2px); }
    .word.disabled { opacity: 0.5; cursor: default; pointer-events: none; }
    .word.correct-reveal  { background: var(--green-light); border-color: var(--green-dark); }
    .word.incorrect-reveal { background: var(--pink); border-color: #e53935; }

    /* result feedback (shown after Next) */
    .result { margin-top: 14px; font-size: 1.05rem; font-weight: 700; display: none; }
    .correct   { color: var(--green-dark); }
    .incorrect { color: #e53935; }

    /* next / finish buttons */
    #buttons { display: none; margin-top: 10px; }
    #buttons button {
      font-family: 'Fredoka', sans-serif; font-weight: 700; font-size: 1rem;
      padding: 10px 22px; border: var(--border-thick); border-radius: 50px;
      box-shadow: var(--shadow-sm); cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s; margin: 5px;
    }
    #buttons button:hover:not(:disabled) { transform: translate(-2px,-2px); box-shadow: 5px 5px 0 var(--black); }
    #buttons button.next   { background: var(--green); color: white; }
    #buttons button.finish { background: var(--yellow); color: var(--black); }
    #buttons button:disabled { opacity: 0.4; cursor: not-allowed; }

    /* â”€â”€ SCORE SUMMARY â”€â”€ */
    .score-summary {
      display: none; text-align: center; padding: 24px 0 8px;
    }
    .score-circle {
      width: 120px; height: 120px; border-radius: 50%;
      border: var(--border-thick); margin: 0 auto 16px;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      box-shadow: var(--shadow-lg);
      font-weight: 700;
    }
    .score-circle .score-num { font-size: 2.2rem; line-height: 1; }
    .score-circle .score-label { font-size: 0.85rem; color: #666; }
    .score-summary h2 { font-size: 1.4rem; margin-bottom: 8px; }
    .score-summary p  { color: #666; font-size: 0.97rem; margin-bottom: 18px; }

    .restart-btn {
      font-family: 'Fredoka', sans-serif; font-weight: 700; font-size: 1rem;
      background: var(--green); color: white;
      padding: 10px 28px; border: var(--border-thick); border-radius: 50px;
      box-shadow: var(--shadow-md); cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s;
    }
    .restart-btn:hover { transform: translate(-2px,-2px); box-shadow: 6px 6px 0 var(--black); }

    .hint-text { font-size: 0.9rem; color: #888; margin-top: 12px; border-top: var(--border); padding-top: 10px; }

    /* replay audio button */
    .replay-btn {
      font-family: 'Fredoka', sans-serif; font-weight: 700; font-size: 0.95rem;
      background: var(--sky-pale); border: var(--border); border-radius: 50px;
      padding: 8px 18px; box-shadow: var(--shadow-sm); cursor: pointer;
      transition: transform 0.12s, box-shadow 0.12s; margin: 5px;
    }
    .replay-btn:hover { transform: translate(-2px,-2px); box-shadow: 5px 5px 0 var(--black); }

    /* inline image in sentence / option */
    .img-token { display: inline-flex; align-items: center; vertical-align: middle; margin: 0 2px; }
    .img-token img { max-height: 44px; width: auto; border: var(--border); border-radius: 8px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       WORD POPUP OVERLAY
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.55); z-index: 999;
    }
    .image-card {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: var(--white); border: var(--border-thick); border-radius: 22px;
      padding: 24px; box-shadow: var(--shadow-lg); z-index: 1000;
      width: 320px; text-align: center;
    }
    .image-card img { max-width: 100%; height: auto; border-radius: 10px; border: var(--border); }
    .image-card h3 { margin: 12px 0 6px; font-size: 1.2rem; }
    .image-card p  { font-size: 0.95rem; color: #666; }
    .image-card .close {
      position: absolute; top: 12px; right: 16px;
      cursor: pointer; font-size: 1.6rem; color: #aaa; line-height: 1;
      background: none; border: none; font-family: inherit;
    }
    .image-card .close:hover { color: var(--black); }
    #writer-container { display: flex; gap: 12px; justify-content: center; align-items: center; flex-wrap: wrap; }
    .image-card audio { width: 100%; margin-top: 10px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SIDEBAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .thumbnails-section {
      flex: 1; min-width: 260px; max-width: 320px;
      position: sticky; top: 86px; align-self: flex-start;
    }
    .sidebar-card {
      background: var(--white); border: var(--border-thick); border-radius: 22px;
      box-shadow: var(--shadow-md); padding: 18px;
      max-height: calc(100vh - 120px); overflow-y: auto;
    }
    .sidebar-card h3 {
      font-weight: 700; font-size: 1.15rem; margin-bottom: 16px;
      display: inline-block;
      background: var(--sky); border: var(--border); border-radius: 50px;
      padding: 5px 18px; box-shadow: var(--shadow-sm);
    }
    .thumbnail {
      display: flex; gap: 10px; margin-bottom: 14px; align-items: center;
      cursor: pointer; border: var(--border); border-radius: 14px;
      overflow: hidden; background: var(--bg);
      transition: transform 0.12s, box-shadow 0.12s;
    }
    .thumbnail:hover { transform: translate(-2px,-2px); box-shadow: 4px 4px 0 var(--black); }
    .thumbnail a { text-decoration: none; color: inherit; display: flex; gap: 10px; align-items: center; width: 100%; padding: 8px; }
    .thumbnail img { width: 90px; height: 56px; border-radius: 8px; border: var(--border); object-fit: cover; flex-shrink: 0; }
    .thumbnail h4 { font-size: 0.9rem; font-weight: 600; color: var(--black); margin: 0 0 3px; }
    .thumbnail p  { font-size: 0.78rem; color: #777; margin: 0; }

    /* â”€â”€ FIXED TAGS â”€â”€ */
    .buy-coffee, .new-words {
      position: fixed; right: 20px;
      background: var(--yellow); border: var(--border-thick);
      border-radius: 20px; padding: 10px 14px;
      box-shadow: var(--shadow-md); font-weight: 700; font-size: 0.9rem;
      z-index: 50; transition: transform 0.12s;
    }
    .buy-coffee { top: calc(50% - 70px); }
    .new-words  { top: 50%; transform: translateY(-50%); }
    .buy-coffee a, .new-words a { text-decoration: none; color: var(--black); }
    .buy-coffee:hover { transform: translate(-2px,-2px); }
    .new-words:hover  { transform: translateY(-50%) translate(-2px,-2px); }

    /* â”€â”€ FOOTER â”€â”€ */
    footer {
      background: #222; color: rgba(255,255,255,0.65);
      padding: 28px 50px; text-align: center; position: relative; z-index: 1;
    }
    footer .brand { font-weight: 700; color: var(--green-light); font-size: 1.3rem; margin-bottom: 6px; }
    footer p { font-size: 0.95rem; font-weight: 500; margin-bottom: 3px; }
    .social-icons { margin-top: 14px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
    .social-icons a {
      text-decoration: none; color: var(--black); font-weight: 600; font-size: 0.9rem;
      background: var(--green-light); border: var(--border); border-radius: 50px;
      padding: 5px 16px; box-shadow: var(--shadow-sm); transition: transform 0.12s;
    }
    .social-icons a:hover { transform: translate(-1px,-2px); }

    a { color: var(--green-dark); text-decoration: none; }
    a:hover { color: #e53935; }

    @media (max-width: 1024px) {
      .container { flex-direction: column; padding: 20px 20px 80px; }
      .thumbnails-section { max-width: 100%; width: 100%; position: static; }
      .sidebar-card { max-height: 400px; }
      .video-card iframe { height: 400px; }
    }
    @media (max-width: 768px) {
      .container { padding: 16px 16px 80px; }
      .video-card iframe { height: 280px; }
      .buy-coffee, .new-words { right: 10px; padding: 8px 10px; font-size: 0.8rem; }
      .buy-coffee { top: calc(50% - 55px); }
      footer { padding: 28px 20px; }
      .sentence { font-size: 1.3rem; }
      .word { font-size: 1.1rem; }
      .content-image { max-width: 80px; }
    }
    @media (max-width: 480px) {
      header h1 { font-size: 1.3rem; }
      .sentence { font-size: 1.1rem; }
      .word { font-size: 1rem; padding: 8px 14px; }
      .qcontainer { padding: 18px 16px; }
      .content-image { max-width: 65px; }
    }
  </style>
</head>
<body>

  <!-- â•â•â• HEADER â•â•â• -->
  <header>
    <h1><a href="index.html" class="homepage-link">CHINESE 60s</a></h1>
    <button class="menu-toggle" aria-label="Toggle navigation">&#9776;</button>
    <nav>
      <ul>
        <li><a href="about.html">About Us</a></li>
        <li><a href="courses.html">Courses</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="https://www.amazon.com/shop/studiorum60s" target="_blank">Amazon</a></li>

        <!-- AUTH AREA â€” toggled by JS -->
        <li id="auth-nav-item">
          <!-- State A: not logged in -->
          <button id="sign-in-btn" onclick="openLoginModal()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"><path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z" fill="#333"/></svg>
            Sign In
          </button>

          <!-- State B: logged in (hidden by default) -->
          <div class="user-menu-wrap" id="user-menu-wrap" style="display:none;">
            <div class="auth-pill" id="user-pill" onclick="toggleUserMenu()">
              <div class="avatar" id="nav-avatar">ğŸ‘¤</div>
              <span id="nav-username">User</span>
            </div>
            <div class="user-dropdown" id="user-dropdown">
              <a href="profile.html">ğŸ‘¤ My Profile</a>
              <hr class="sep">
              <button class="sign-out" onclick="signOut()">ğŸšª Sign Out</button>
            </div>
          </div>
        </li>
      </ul>
    </nav>
  </header>

  <!-- â•â•â• LOGIN MODAL â•â•â• -->
  <div class="modal-overlay" id="login-modal">
    <div class="modal">
      <button class="modal-close" onclick="closeLoginModal()">âœ•</button>
      <div class="modal-icon">ğŸ”</div>
      <h2>Sign in to continue</h2>
      <p>Sign in with your Google account to access the practice quiz and track your progress.</p>
      <button class="google-btn" onclick="doGoogleSignIn()">
        <!-- Google G logo SVG -->
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
          <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
          <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/>
          <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
        </svg>
        Continue with Google
      </button>
    </div>
  </div>

  <!-- â•â•â• BANNER â•â•â• -->
  <div class="logos-and-title">
    <img src="assets/banner.png" alt="Chinese 60s" class="logo">
  </div>

  <!-- â•â•â• MAIN LAYOUT â•â•â• -->
  <div class="container">

    <div class="video-section">

      <!-- Video Card -->
      <div class="video-card">
        <h1 id="video-title"></h1>
        <h3 id="video-description"></h3>
        <iframe id="video-iframe" src="" title="YouTube video player" allowfullscreen></iframe>
        <script src="js/fetch-video.js"></script>
      </div>

      <!-- Post Content -->
      <div class="pcontainer">
        <ul class="content-list" id="itemList"></ul>
      </div>
      <script src="js/posts-loader.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const p = new URLSearchParams(window.location.search);
          loadPosts(p.get('postStartId') || '21', p.get('postEndId') || '32', 'itemList');
        });
      </script>

      <!-- â•â•â• QUIZ SECTION â•â•â• -->
      <div class="qcontainer" id="quiz-container" data-start-id="24" data-end-id="38">
        <h1>Let's Practice! ğŸ¯</h1>

        <!-- Quiz content â€” always visible; Start button checks auth -->
        <div id="quiz-unlocked">
          <div id="start-container">
            <button id="start-button">â–¶ Start Quiz</button>
          </div>

          <!-- Progress -->
          <div class="quiz-counter" id="quiz-counter"></div>
          <div class="quiz-progress-wrap" id="quiz-progress-wrap">
            <div class="quiz-progress-fill" id="quiz-progress-fill"></div>
          </div>

          <div class="sentence" id="sentence"></div>
          <div class="options"  id="options"></div>
          <div class="result"   id="result"></div>
          <div id="buttons"></div>

          <!-- Score summary (end screen) -->
          <div class="score-summary" id="score-summary">
            <div class="score-circle" id="score-circle">
              <span class="score-num" id="score-num">0/0</span>
              <span class="score-label">correct</span>
            </div>
            <h2 id="score-title">Quiz Complete!</h2>
            <p id="score-msg"></p>
            <button class="restart-btn" id="restart-btn">â–¶ Try Again</button>
          </div>
        </div>
      </div>

      <p class="hint-text">ğŸ’¡ Click on each Chinese character to see its meaning and pronunciation</p>
    </div>

    <!-- Sidebar -->
    <div class="thumbnails-section">
      <div class="sidebar-card">
        <h3>Other Videos</h3>
        <div id="thumbnails-container"></div>
      </div>
    </div>

  </div>

  <!-- Fixed Tags -->
  <div class="buy-coffee"><a href="https://buymeacoffee.com/chinese60s" target="_blank">â˜• Donate</a></div>
  <div class="new-words"><a href="write.html">âœï¸ Learn to Write</a></div>

  <!-- Footer -->
  <footer>
    <p class="brand">CHINESE 60s</p>
    <p>Learn Mandarin through images and videos</p>
    <div class="social-icons">
      <a href="#">Facebook</a>
      <a href="#">YouTube</a>
      <a href="#">TikTok</a>
      <a href="#">Instagram</a>
    </div>
  </footer>

  <!-- quiz.js NOT loaded â€” logic fully inlined below -->

  <!-- Sidebar thumbnails -->
  <script>
    fetch('data/thumbnail.json')
      .then(r => r.json())
      .then(videos => {
        videos.sort((a, b) => b.id - a.id);
        const container = document.getElementById('thumbnails-container');
        videos.slice(0, 20).forEach(video => {
          const div = document.createElement('div');
          div.classList.add('thumbnail');
          div.innerHTML = `<a href="${video.htmlLink}"><img src="${video.thumbnail}" alt="${video.title}"><div><h4>${video.title}</h4><p>${video.description}</p></div></a>`;
          container.appendChild(div);
        });
      })
      .catch(err => console.error('Error loading JSON:', err));
  </script>

  <!-- Hamburger -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const menuToggle = document.querySelector('.menu-toggle');
      const nav = document.querySelector('nav');
      menuToggle.addEventListener('click', function () {
        nav.classList.toggle('show');
        menuToggle.innerHTML = nav.classList.contains('show') ? '&#10005;' : '&#9776;';
      });
    });
  </script>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AUTH â€” Firebase + Google Sign-In
       (replace firebaseConfig with your actual config)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithRedirect,
      getRedirectResult,
      signOut as fbSignOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    /* â”€â”€ Replace with your actual Firebase config â”€â”€ */
    const firebaseConfig = {
      apiKey:            "AIzaSyAm-qQrpXKNdqFLITRAGCug7rkskGzyAkg",
      authDomain:        "chinese60s.firebaseapp.com",
      projectId:         "chinese60s",
      storageBucket:     "chinese60s.firebasestorage.app",
      messagingSenderId: "835657861121",
      appId:             "1:835657861121:web:f31727eb7ea3b876a5d800",
      measurementId: "G-70NQ4PFTSN"
    };

    const app      = initializeApp(firebaseConfig);
    const auth     = getAuth(app);
    const provider = new GoogleAuthProvider();

    /* handle redirect result on page load (after Google sends user back) */
    getRedirectResult(auth).catch(err => console.error("Redirect result error:", err));

    /* â”€â”€ Expose helpers to window so onclick= attributes work â”€â”€ */
    window.doGoogleSignIn = function () {
      /* redirect â€” no popup, no browser block */
      signInWithRedirect(auth, provider);
    };

    window.signOut = async function () {
      await fbSignOut(auth);
    };

    window.openLoginModal  = () => document.getElementById('login-modal').classList.add('open');
    window.closeLoginModal = () => document.getElementById('login-modal').classList.remove('open');

    /* close modal on overlay click */
    document.getElementById('login-modal').addEventListener('click', function(e) {
      if (e.target === this) closeLoginModal();
    });

    window.toggleUserMenu = function () {
      document.getElementById('user-menu-wrap').classList.toggle('open');
    };
    /* close dropdown on outside click */
    document.addEventListener('click', (e) => {
      const wrap = document.getElementById('user-menu-wrap');
      if (wrap && !wrap.contains(e.target)) wrap.classList.remove('open');
    });

    /* â”€â”€ Auth state â†’ update header only â”€â”€ */
    onAuthStateChanged(auth, (user) => {
      const signInBtn      = document.getElementById('sign-in-btn');
      const userMenuWrap   = document.getElementById('user-menu-wrap');
      const navUsername    = document.getElementById('nav-username');
      const navAvatar      = document.getElementById('nav-avatar');

      if (user) {
        /* logged in â†’ show user pill in header */
        signInBtn.style.display    = 'none';
        userMenuWrap.style.display = 'block';
        navUsername.textContent    = user.displayName?.split(' ')[0] || 'User';
        if (user.photoURL) {
          navAvatar.innerHTML = `<img src="${user.photoURL}" alt="avatar">`;
        } else {
          navAvatar.textContent = user.displayName?.[0]?.toUpperCase() || '?';
        }
        /* expose user so quiz can check */
        window.__currentUser = user;
      } else {
        /* logged out â†’ show Sign In button */
        signInBtn.style.display    = 'inline-flex';
        userMenuWrap.style.display = 'none';
        window.__currentUser       = null;
      }
    });
  </script>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       QUIZ LOGIC â€” based on original quiz.js data structure:
         quiz.json â†’ { questions: [ { id, sentence, blanks:[{answer}], words:[], audio? } ] }

       Rules:
         âœ” Auth gate on Start (open modal if not logged in)
         âœ” Multi-blank support (matches original quiz.js)
         âœ” Click a selected word again â†’ deselect (unfill that blank)
         âœ” All blanks filled â†’ Next/Finish button enables
         âœ” Next â†’ reveal correct/wrong colour on every option â†’ show feedback
         âœ” No Retry button
         âœ” Final score summary with colour-coded circle
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
  (function () {

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HELPERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function isImagePath(p) { return /\.(jpe?g|png|gif|bmp|webp|svg)$/i.test(p); }

    /* Render a word/sentence token â€” text or inline image */
    function renderToken(token) {
      if (!token && token !== 0) return '';
      const s = String(token);
      if (isImagePath(s)) {
        return `<span class="img-token"><img src="${s}" alt="" class="content-image"></span>`;
      }
      return s;
    }

    /* Build sentence HTML, replacing each '___' with a numbered blank span */
    function buildSentenceHTML(sentence, blankCount) {
      let html = Array.isArray(sentence)
        ? sentence.map(renderToken).join('')
        : renderToken(sentence);

      let i = 0;
      html = html.replace(/___/g, () =>
        `<span class="blank" data-blank-index="${i++}"></span>`
      );
      return html;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    let allQuestions  = [];   // filtered from JSON
    let currentIndex  = 0;
    let scoreCorrect  = 0;
    let revealed      = false;

    /*
      selectedSlots: array parallel to blanks[]
      each slot: { wordText, wordEl } | null
    */
    let selectedSlots = [];

    /* audio elements */
    const clickAudio     = new Audio('assets/click.mp3');
    const correctAudio   = new Audio('assets/correct.mp3');
    const incorrectAudio = new Audio('assets/incorrect.mp3');
    const victoryAudio   = new Audio('assets/victory.mp3');
    let   questionAudio  = null;

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DOM REFS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const startContainer = document.getElementById('start-container');
    const startBtn       = document.getElementById('start-button');
    const sentenceEl     = document.getElementById('sentence');
    const optionsEl      = document.getElementById('options');
    const resultEl       = document.getElementById('result');
    const buttonsEl      = document.getElementById('buttons');
    const progressWrap   = document.getElementById('quiz-progress-wrap');
    const progressFill   = document.getElementById('quiz-progress-fill');
    const counterEl      = document.getElementById('quiz-counter');
    const summaryEl      = document.getElementById('score-summary');
    const scoreNumEl     = document.getElementById('score-num');
    const scoreTitleEl   = document.getElementById('score-title');
    const scoreMsgEl     = document.getElementById('score-msg');
    const scoreCircle    = document.getElementById('score-circle');
    const restartBtn     = document.getElementById('restart-btn');

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOAD JSON â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    async function loadQuestions(startId, endId) {
      try {
        const res  = await fetch('data/quiz.json');
        const json = await res.json();

        /* Support both shapes:
           Shape A (original): { questions: [...] }
           Shape B (flat):     [...]                */
        const raw = Array.isArray(json) ? json : (json.questions || []);

        return raw.filter(q => q.id >= startId && q.id <= endId);
      } catch (e) {
        console.warn('quiz.json load failed, using demo data:', e);
        /* Fallback demo â€” uses original data shape */
        return [
          {
            id: 1,
            sentence: 'æˆ‘___è‹¹æœã€‚',
            blanks: [{ answer: 'å–œæ¬¢' }],
            words: ['å–œæ¬¢', 'ä¸æ˜¯', 'å¾ˆå¥½', 'å»']
          },
          {
            id: 2,
            sentence: 'ä»–___è€å¸ˆã€‚',
            blanks: [{ answer: 'æ˜¯' }],
            words: ['æ˜¯', 'æœ‰', 'åœ¨', 'å¾ˆ']
          },
          {
            id: 3,
            sentence: 'æˆ‘ä»¬___ä¸€èµ·___å­¦ä¹ ã€‚',
            blanks: [{ answer: 'å¯ä»¥' }, { answer: 'å¥½å¥½' }],
            words: ['å¯ä»¥', 'ä¸å¥½', 'å¥½å¥½', 'å¾ˆå¤§']
          }
        ];
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• START â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    startBtn.addEventListener('click', async () => {
      /* Auth gate */
      if (!window.__currentUser) {
        openLoginModal();
        return;
      }

      const qc      = document.getElementById('quiz-container');
      const p       = new URLSearchParams(window.location.search);
      const startId = parseInt(p.get('quizStartId')) || parseInt(qc.dataset.startId) || 1;
      const endId   = parseInt(p.get('quizEndId'))   || parseInt(qc.dataset.endId)   || 10;

      allQuestions  = await loadQuestions(startId, endId);
      if (!allQuestions.length) {
        resultEl.textContent    = 'âš ï¸ No questions found for this lesson.';
        resultEl.style.display  = 'block';
        return;
      }

      currentIndex = 0;
      scoreCorrect = 0;

      startContainer.style.display  = 'none';
      progressWrap.style.display    = 'block';
      counterEl.style.display       = 'block';
      summaryEl.style.display       = 'none';
      resultEl.style.display        = 'none';

      showQuestion();
    });

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SHOW QUESTION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function showQuestion() {
      if (currentIndex >= allQuestions.length) { showSummary(); return; }

      const q      = allQuestions[currentIndex];
      const blanks = q.blanks || [];
      revealed     = false;
      selectedSlots = blanks.map(() => null);

      /* â”€â”€ Progress â”€â”€ */
      const pct = (currentIndex / allQuestions.length) * 100;
      progressFill.style.width = pct + '%';
      counterEl.textContent    = `Question ${currentIndex + 1} of ${allQuestions.length}`;

      /* â”€â”€ Sentence â”€â”€ */
      sentenceEl.innerHTML     = buildSentenceHTML(q.sentence, blanks.length);
      sentenceEl.style.display = 'block';

      /* â”€â”€ Options (shuffle words) â”€â”€ */
      const words = [...(q.words || [])].sort(() => Math.random() - 0.5);
      optionsEl.innerHTML = '';

      words.forEach(word => {
        const btn     = document.createElement('button');
        btn.className = 'word';
        btn.innerHTML = renderToken(word);
        btn.dataset.word = String(word);
        btn.addEventListener('click', () => handleWordClick(btn));
        optionsEl.appendChild(btn);
      });
      optionsEl.style.display = 'block';

      /* â”€â”€ Feedback hidden â”€â”€ */
      resultEl.style.display = 'none';
      resultEl.textContent   = '';
      resultEl.className     = 'result';

      /* â”€â”€ Buttons â”€â”€ */
      buttonsEl.innerHTML = '';
      buttonsEl.style.display = 'block';

      /* Replay audio button (if question has audio) */
      if (q.audio) {
        if (questionAudio) { questionAudio.pause(); }
        questionAudio = new Audio(q.audio);
        questionAudio.play().catch(() => {});

        const replayBtn = document.createElement('button');
        replayBtn.className   = 'replay-btn';
        replayBtn.textContent = 'ğŸ”Š Replay';
        replayBtn.addEventListener('click', () => {
          questionAudio.currentTime = 0;
          questionAudio.play().catch(() => {});
        });
        buttonsEl.appendChild(replayBtn);
      }

      /* Next/Finish â€” disabled until all blanks filled */
      const isLast    = currentIndex === allQuestions.length - 1;
      const actionBtn = document.createElement('button');
      actionBtn.textContent = isLast ? 'Finish âœ“' : 'Next â†’';
      actionBtn.className   = isLast ? 'finish' : 'next';
      actionBtn.disabled    = true;
      actionBtn.id          = 'action-btn';
      actionBtn.addEventListener('click', () => revealAndAdvance(q));
      buttonsEl.appendChild(actionBtn);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• WORD CLICK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function handleWordClick(btn) {
      if (revealed) return;
      clickAudio.currentTime = 0;
      clickAudio.play().catch(() => {});

      const word = btn.dataset.word;

      /* Check if this word button is already placed in a slot */
      const existingSlotIndex = selectedSlots.findIndex(
        s => s && s.wordEl === btn
      );

      if (existingSlotIndex !== -1) {
        /* â”€â”€ DESELECT: remove from blank â”€â”€ */
        selectedSlots[existingSlotIndex] = null;
        btn.classList.remove('selected');
        const blankEl = sentenceEl.querySelector(`[data-blank-index="${existingSlotIndex}"]`);
        if (blankEl) { blankEl.innerHTML = ''; blankEl.classList.remove('filled'); }
        updateActionBtn();
        return;
      }

      /* â”€â”€ SELECT: fill the first empty blank â”€â”€ */
      const emptyIndex = selectedSlots.findIndex(s => s === null);
      if (emptyIndex === -1) return; // all blanks filled by other words â€” shouldn't happen if UI is correct

      selectedSlots[emptyIndex] = { wordText: word, wordEl: btn };
      btn.classList.add('selected');

      const blankEl = sentenceEl.querySelector(`[data-blank-index="${emptyIndex}"]`);
      if (blankEl) {
        blankEl.innerHTML = renderToken(word);
        blankEl.classList.add('filled');
      }

      updateActionBtn();
    }

    function updateActionBtn() {
      const btn = document.getElementById('action-btn');
      if (!btn) return;
      const allFilled = selectedSlots.every(s => s !== null);
      btn.disabled = !allFilled;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• REVEAL (after Next) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function revealAndAdvance(q) {
      if (revealed) return;
      const allFilled = selectedSlots.every(s => s !== null);
      if (!allFilled) return;

      revealed = true;
      const blanks = q.blanks || [];

      /* Check correctness per blank */
      let questionCorrect = true;
      blanks.forEach((blank, i) => {
        const slot = selectedSlots[i];
        if (!slot || String(slot.wordText) !== String(blank.answer)) {
          questionCorrect = false;
        }
      });

      if (questionCorrect) scoreCorrect++;

      /* Colour all option buttons */
      optionsEl.querySelectorAll('.word').forEach(btn => {
        btn.classList.add('disabled');
        btn.style.pointerEvents = 'none';

        const isCorrectWord = blanks.some(b => String(b.answer) === btn.dataset.word);
        const wasSelected   = selectedSlots.some(s => s && s.wordEl === btn);

        if (isCorrectWord) {
          btn.classList.add('correct-reveal');
        } else if (wasSelected && !isCorrectWord) {
          btn.classList.remove('selected');
          btn.classList.add('incorrect-reveal');
        }
      });

      /* Also colour the blanks in the sentence */
      blanks.forEach((blank, i) => {
        const blankEl = sentenceEl.querySelector(`[data-blank-index="${i}"]`);
        const slot    = selectedSlots[i];
        if (!blankEl) return;
        if (slot && String(slot.wordText) === String(blank.answer)) {
          blankEl.style.color       = 'var(--green-dark)';
          blankEl.style.borderColor = 'var(--green)';
        } else {
          blankEl.style.color       = '#e53935';
          blankEl.style.borderColor = '#e53935';
          /* show correct answer beside */
          blankEl.innerHTML += ` <small style="font-size:0.7em;opacity:0.8">(${blank.answer})</small>`;
        }
      });

      /* Play sound */
      if (questionCorrect) {
        correctAudio.currentTime = 0;
        correctAudio.play().catch(() => {});
        resultEl.textContent = 'âœ… Correct!';
        resultEl.className   = 'result correct';
      } else {
        incorrectAudio.currentTime = 0;
        incorrectAudio.play().catch(() => {});
        const correctList = blanks.map(b => b.answer).join('ã€');
        resultEl.textContent = `âŒ Answer: ${correctList}`;
        resultEl.className   = 'result incorrect';
      }
      resultEl.style.display = 'block';

      /* Swap Next/Finish â†’ Continue */
      const actionBtn = document.getElementById('action-btn');
      if (actionBtn) {
        actionBtn.disabled    = false;
        actionBtn.textContent = currentIndex === allQuestions.length - 1
          ? 'See Results ğŸ†'
          : 'Continue â†’';
        actionBtn.className   = currentIndex === allQuestions.length - 1 ? 'finish' : 'next';

        /* remove old listener, add new */
        const fresh = actionBtn.cloneNode(true);
        actionBtn.replaceWith(fresh);
        fresh.addEventListener('click', () => {
          currentIndex++;
          showQuestion();
        });
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SUMMARY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function showSummary() {
      sentenceEl.style.display   = 'none';
      optionsEl.style.display    = 'none';
      resultEl.style.display     = 'none';
      buttonsEl.style.display    = 'none';
      progressWrap.style.display = 'none';
      counterEl.style.display    = 'none';

      victoryAudio.play().catch(() => {});

      const total = allQuestions.length;
      const pct   = total > 0 ? Math.round((scoreCorrect / total) * 100) : 0;
      progressFill.style.width = '100%';
      scoreNumEl.textContent   = `${scoreCorrect}/${total}`;

      if (pct >= 80) {
        scoreCircle.style.background  = 'var(--green-pale)';
        scoreCircle.style.borderColor = 'var(--green)';
        scoreTitleEl.textContent      = 'ğŸ‰ Excellent!';
        scoreMsgEl.textContent        = `You got ${scoreCorrect} out of ${total} correct (${pct}%). Outstanding!`;
      } else if (pct >= 50) {
        scoreCircle.style.background  = 'var(--yellow-pale)';
        scoreCircle.style.borderColor = 'var(--yellow)';
        scoreTitleEl.textContent      = 'ğŸ‘ Good effort!';
        scoreMsgEl.textContent        = `You got ${scoreCorrect} out of ${total} correct (${pct}%). Keep it up!`;
      } else {
        scoreCircle.style.background  = 'var(--pink-pale)';
        scoreCircle.style.borderColor = 'var(--pink)';
        scoreTitleEl.textContent      = 'ğŸ’ª Keep going!';
        scoreMsgEl.textContent        = `You got ${scoreCorrect} out of ${total} correct (${pct}%). Try again!`;
      }

      summaryEl.style.display = 'block';
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESTART â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    restartBtn.addEventListener('click', () => {
      summaryEl.style.display      = 'none';
      startContainer.style.display = 'block';
      progressWrap.style.display   = 'none';
      counterEl.style.display      = 'none';
      progressFill.style.width     = '0%';
      sentenceEl.style.display     = 'none';
      optionsEl.style.display      = 'none';
      buttonsEl.style.display      = 'none';
      resultEl.style.display       = 'none';
    });

  })();
  </script>

</body>
</html>
