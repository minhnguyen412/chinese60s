<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chinese60s Multi-Quiz</title>
<style>
body { font-family: Arial; margin: 0 auto;}
table { border-collapse: collapse; width: 100%; margin-bottom: 30px; }
td { border: 1px solid #ccc; padding: 10px; width: 33%; vertical-align: middle; text-align: center;}
.cell-buttons, .cell-area { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; justify-content: center;}
button { padding: 4px 8px; font-size: 14px; cursor: pointer; }
select { padding: 3px; font-size: 14px; }
.correct { background-color: #c8ffcc !important; }
.wrong { background-color: #ffc8c8 !important; }
h3 { margin-top: 40px; }
.content-container {
  display: none;
  max-width: 900px;      /* Gi·ªõi h·∫°n chi·ªÅu ngang */
  margin: 0 auto;        /* Canh gi·ªØa container */
  padding: 20px;         /* Kho·∫£ng c√°ch trong container */
}
/* Header */
    header {
      background-color: #8bc34a;
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-left: 50px;
      padding-right: 50px;
    }
    .homepage-link {
      text-decoration: none;
      color: inherit; /* Gi·ªØ nguy√™n m√†u s·∫Øc c·ªßa text g·ªëc */
    }

    
    .menu-toggle {
      display: none;
      font-size: 24px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
    }
    nav ul {
      list-style: none;
      display: flex;
      gap: 20px;
    }

    nav ul li a {
      text-decoration: none;
      color: white;
      font-weight: bold;
    }

    nav ul li a:hover {
      text-decoration: underline;
    }
    nav {
      display: flex;
    }

    /* Responsive cho m√†n h√¨nh nh·ªè h∆°n 768px */
    @media screen and (max-width: 768px) {
      .menu-toggle {
        display: block;
        position: absolute;
        
        right: 20px;
      }

      nav {
        display: none;
        flex-direction: column;
        position: absolute;
        top: 60px;
        right: 0;
        background-color: #8bc34a;
        width: 100%;
        padding: 10px 0;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      nav.show {
        display: flex;
      }

      nav ul {
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      nav ul li a {
        font-size: 1rem;
      }
    }
/* Footer */
    footer {
      background-color: #8bc34a;
      color: white;
      padding: 15px;
      text-align: center;
    }

    footer .social-icons {
      margin-top: 10px;
    }

    footer .social-icons a {
      margin: 0 10px;
      text-decoration: none;
      color: white;
    }
  #locked-section {
  max-width: 400px;          /* Gi·ªõi h·∫°n chi·ªÅu ngang */
  margin: 100px auto;        /* Canh gi·ªØa m√†n h√¨nh, c√°ch top 100px */
  padding: 30px 20px;        /* Kho·∫£ng c√°ch trong box */
  background-color: #f7f7f7; /* N·ªÅn nh·∫π */
  border: 2px solid #8bc34a; /* Vi·ªÅn xanh nh·∫°t */
  border-radius: 12px;       /* Bo g√≥c */
  box-shadow: 0 8px 20px rgba(0,0,0,0.1); /* B√≥ng nh·∫π */
  text-align: center;        /* Canh text gi·ªØa */
  font-family: Arial, sans-serif;
}

#locked-section h2 {
  margin-bottom: 20px;
  font-size: 20px;
  color: #333;
}

#locked-section input {
  width: 80%;
  padding: 10px;
  font-size: 16px;
  margin-bottom: 15px;
  border: 1px solid #ccc;
  border-radius: 6px;
  box-sizing: border-box;
}

#locked-section button {
  padding: 10px 25px;
  font-size: 16px;
  background-color: #8bc34a;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.3s;
}

#locked-section button:hover {
  background-color: #7cb342;
}

#locked-section #status {
  margin-top: 15px;
  color: red;
  font-weight: bold;
}
</style>
</head>
<body>
<!-- Header -->
  <header>
    <h1><a href="index.html" class="homepage-link">CHINESE 60s</a></h1>
    <button class="menu-toggle" aria-label="Toggle navigation">
      &#9776;
    </button>
    <nav>
      <ul>
        <li><a href="about.html">About Us</a></li>
        <li><a href="courses.html">Courses</a></li>
        <li><a href="https://www.amazon.com/shop/studiorum60s">Shop</a></li>
      </ul>
    </nav>
  </header>

<div id="locked-section">
  <h2>Enter the license key to view the content</h2>
  <input id="licenseInput" type="text" placeholder="Enter license key...";">
  <button id="verifyBtn";">Unlock</button>
  <p id="status";"></p>
</div>  
<!-- Container ri√™ng cho n·ªôi dung quiz -->
  <div class="content-container">
    <h1>Chinese60s Pronunciation Quiz</h1>

    <h3>Listen to the following initials and finals and choose the correct answer</h3>
    <table id="quiz-grid-mcq1"></table>

    <h3>Distinguish easily confused tones</h3>
    <table id="quiz-grid-mcq2"></table>

    <h3>Choose the correct tone based on the tone-change rules</h3>
    <table id="quiz-grid-tone"></table>

    <h3>Fill in the blanks with multi-syllable phrases</h3>
    <p>Type the pinyin following these rules: ƒÅ = a1;  √° = a2; «é = a3; √† = a4; √º = v</p>
    <table id="quiz-grid-fillin"></table>
  </div>
<!-- Footer -->
  <footer>
    <p>Chinese60s</p>
    <p>Learn Mandarin through images and videos</p>
    <div class="social-icons">
      <a href="#">Facebook</a>
      <a href="#">YouTube</a>
      <a href="#">TikTok</a>
      <a href="#">Instagram</a>
    </div>
  </footer>
<script>
const PRODUCT_ID = "ufowKPN1xaOa-ueREQbmOw=="; // ‚Üê ƒê·ªîI TH√ÄNH C√ÅI N√ÄY

// N·∫øu ƒë√£ m·ªü tr∆∞·ªõc ƒë√≥, show lu√¥n
if (localStorage.getItem("unlocked") === "yes") {
    document.getElementById("locked-section").style.display = "none";
    document.querySelector(".content-container").style.display = "block";
}

document.getElementById("verifyBtn").addEventListener("click", async function () {
    const key = document.getElementById("licenseInput").value.trim();
    const status = document.getElementById("status");

    if (!key) {
        status.textContent = "Please enter a valid license key.";
        return;
    }

    status.textContent = "Checking...";

    const form = new URLSearchParams();
    form.append("product_id", PRODUCT_ID);
    form.append("license_key", key);

    try {
        const response = await fetch("https://api.gumroad.com/v2/licenses/verify", {
            method: "POST",
            body: form
        });

        const data = await response.json();
        console.log("Response:", data);

        if (data.success) {
            localStorage.setItem("unlocked", "yes");
            document.getElementById("locked-section").style.display = "none";
            document.querySelector(".content-container").style.display = "block";
            status.textContent = "";
        } else {
            status.textContent = "Invalid license key.";
        }
    } catch (error) {
        console.error("Error:", error);
        status.textContent = "Connection error. Please try again.";
    }
});
</script>
  
<script>
// Map thanh ƒëi·ªáu
const toneMap = {
    a: ["ƒÅ","√°","«é","√†"],
    e: ["ƒì","√©","ƒõ","√®"],
    i: ["ƒ´","√≠","«ê","√¨"],
    o: ["≈ç","√≥","«í","√≤"],
    u: ["≈´","√∫","«î","√π"],
    √º: ["«ñ","«ò","«ö","«ú"]
};

// H√†m convert ch√≠nh
function convertPinyin(str) {
    // ƒë·ªïi "v" ‚Üí "√º"
    str = str.replace(/v/g, "√º");

    return str.replace(/([a-z√º]+)([1-4])/gi, (match, letters, tone) => {
        const t = parseInt(tone) - 1;
        letters = letters.toLowerCase();

        // th·ª© t·ª± ∆∞u ti√™n ƒë·∫∑t d·∫•u
        const priority = ["a","e","o","u","i","√º"];

        for (let v of priority) {
            const idx = letters.indexOf(v);
            if (idx !== -1) {
                const accented = toneMap[v][t];
                return (
                    letters.slice(0, idx) +
                    accented +
                    letters.slice(idx + v.length)
                );
            }
        }

        return match;
    });
}

// √Åp d·ª•ng v√†o input .pinyin-input
document.addEventListener("input", (e) => {
    if (e.target.classList.contains("pinyin-input")) {
        const pos = e.target.selectionStart;
        e.target.value = convertPinyin(e.target.value);
        e.target.setSelectionRange(pos, pos);
    }
});
</script>

<script>
async function loadAllGrids() {
    const res = await fetch("https://raw.githubusercontent.com/minhnguyen412/chinese60s/refs/heads/main/data/yuyin-quiz.json");
    const data = await res.json();

    const tables = [
        {id: "quiz-grid-mcq1", group: "mcq1"},
        {id: "quiz-grid-mcq2", group: "mcq2"},
        {id: "quiz-grid-tone", group: "tone"},
        {id: "quiz-grid-fillin", group: "fill"}
    ];

    tables.forEach(t => renderGrid(data, t.id, t.group));
}

function renderGrid(data, tableId, group) {
    const table = document.getElementById(tableId);
    const COLUMNS = 3;
    let row;

    data.filter(q => q.group === group).forEach((q, index) => {

        if (index % COLUMNS === 0) {
            row = document.createElement("tr");
            table.appendChild(row);
        }

        const cell = document.createElement("td");

        /* ------------------ MULTIPLE CHOICE ------------------ */
        if (q.type === "choice") {
            cell.dataset.answer = q.answer;
            cell.innerHTML = `
                <div class="cell-buttons">
                    <button onclick="playAudio('${q.audio}')">üîä</button>
                    <button onclick="checkAnswer(this,0)">${q.options[0]}</button>
                    <button onclick="checkAnswer(this,1)">${q.options[1]}</button>
                </div>
            `;
        }

        /* ------------------ TONE TYPE (2‚Äì3 c·ª•m) ------------------ */
        else if (q.type === "tone") {
            cell.dataset.tone1 = q.tone1;
            cell.dataset.tone2 = q.tone2;
            if (q.text3 && q.tone3 !== undefined) cell.dataset.tone3 = q.tone3;

            let html = `
                <div class="cell-area">
                    <button onclick="playAudio('${q.audio}')">üîä</button>
                    <span>${q.text1}</span>
                    <select class="select1">
                        <option value="">-</option><option value="1">1</option>
                        <option value="2">2</option><option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                    <span>${q.text2}</span>
                    <select class="select2">
                        <option value="">-</option><option value="1">1</option>
                        <option value="2">2</option><option value="3">3</option>
                        <option value="4">4</option>
                    </select>
            `;

            if (q.text3 && q.tone3 !== undefined) {
                html += `
                    <span>${q.text3}</span>
                    <select class="select3">
                        <option value="">-</option><option value="1">1</option>
                        <option value="2">2</option><option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                `;
            }

            html += `<button onclick="checkTone(this)">Check</button></div>`;
            cell.innerHTML = html;
        }

        /* ------------------ FILL-IN INPUT TYPE ------------------ */
        else if (q.type === "fill") {
            cell.dataset.answer = q.answer;

            cell.innerHTML = `
                <div class="cell-area">
                    <button onclick="playAudio('${q.audio}')">üîä</button>
                    <input type="text" class="pinyin-input fill-input" placeholder="Type the word you hear">
                    <button onclick="checkFill(this)">Check</button>
                </div>
            `;
        }

        row.appendChild(cell);
    });
}

/* ------------------ AUDIO ------------------ */
function playAudio(file) {
    new Audio(file).play();
}

/* ------------------ MCQ CHECK ------------------ */
function checkAnswer(btn, choice) {
    const cell = btn.closest("td");
    const correct = Number(cell.dataset.answer);

    cell.querySelectorAll("button").forEach(b => b.classList.remove("correct","wrong"));
    btn.classList.add(choice===correct ? "correct" : "wrong");
}

/* ------------------ TONE CHECK ------------------ */
function checkTone(btn) {
    const cell = btn.closest("td");

    const correct1 = Number(cell.dataset.tone1);
    const correct2 = Number(cell.dataset.tone2);
    const correct3 = cell.dataset.tone3 ? Number(cell.dataset.tone3) : null;

    const v1 = Number(cell.querySelector(".select1").value);
    const v2 = Number(cell.querySelector(".select2").value);
    const v3 = correct3 !== null ? Number(cell.querySelector(".select3").value) : null;

    cell.classList.remove("correct","wrong");

    let isOK = (v1 === correct1 && v2 === correct2);
    if (correct3 !== null) isOK = isOK && (v3 === correct3);

    cell.classList.add(isOK ? "correct" : "wrong");
}

/* ------------------ FILL-IN CHECK ------------------ */
// Normalize pinyin: ƒë·ªïi v‚Üí√º, convert tone numbers, th·ªëng nh·∫•t d·∫°ng c√≥ d·∫•u
function normalizePinyin(str) {
    if (!str) return "";
    str = str.toLowerCase().trim();
    str = str.replace(/\s+/g, ""); // ‚ùó b·ªè to√†n b·ªô d·∫•u c√°ch
    return convertPinyin(str);     // gi·ªØ nguy√™n h√†m convertPinyin c·ªßa m√†y
}
function checkFill(btn) {
    const cell = btn.closest("td");

    const inputRaw = cell.querySelector(".fill-input").value;
    const correctRaw = cell.dataset.answer;

    const input = normalizePinyin(inputRaw);
    const correct = normalizePinyin(correctRaw);

    // Reset class
    cell.classList.remove("correct","wrong");

    // N·∫øu ƒë√∫ng
    if (input === correct) {
        cell.classList.add("correct");
        cell.dataset.wrongCount = 0;  // reset wrong count
        const ansBox = cell.querySelector(".answer-box");
        if (ansBox) ansBox.remove();
        return;
    }

    // N·∫øu sai
    cell.classList.add("wrong");

    // TƒÉng b·ªô ƒë·∫øm sai
    let count = Number(cell.dataset.wrongCount || 0) + 1;
    cell.dataset.wrongCount = count;

    // N·∫øu sai < 3 ‚Üí kh√¥ng show ƒë√°p √°n
    if (count < 3) return;

    // N·∫øu sai ‚â• 3 l·∫ßn ‚Üí hi·ªán ƒë√°p √°n
    if (!cell.querySelector(".answer-box")) {
        const correctDisplay = cell.dataset.answer; // gi·ªØ nguy√™n format c·ªßa m√†y

        const box = document.createElement("div");
        box.className = "answer-box";
        box.style.marginTop = "6px";
        box.style.fontSize = "14px";
        box.style.color = "#333";

        box.innerHTML = `Answer: <b>${correctDisplay}</b>`;

        cell.appendChild(box);
    }
}
loadAllGrids();
</script>
</body>
</html>







