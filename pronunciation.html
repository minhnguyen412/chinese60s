<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mandarin Chinese Pronunciation Guide</title>
<style>
body {
    font-family:sans-serif;
    margin:16px;
    display:flex;
    justify-content: center;   /* CƒÉn gi·ªØa ngang */
    align-items: flex-start;
    gap:20px;
    background-image: url('yuyin/3.png'); /* ƒê∆∞·ªùng d·∫´n ƒë·∫øn ·∫£nh */
    background-size: cover; /* ·∫¢nh ph·ªß to√†n b·ªô m√†n h√¨nh */
    background-position: center; /* CƒÉn gi·ªØa */
    background-repeat: no-repeat; /* Kh√¥ng l·∫∑p l·∫°i ·∫£nh */
    background-attachment: fixed;
    flex-wrap: wrap;
}

/* Canvas b√™n tr√°i */
.left-panel {
    flex: 0 0 auto;
    max-width: 620px;
    
}

/* Container ch·ª©a PDF + panel ph·∫£i */
.right-panel-container {
    display: flex;
    flex-direction: column; /* pdf-ad n·∫±m tr√™n right-panel */
    gap: 10px;
    
}

/* Right panel m·∫∑c ƒë·ªãnh */
.right-panel {
    display: flex;
    flex-direction: row; /* 2 c·ªôt c·∫°nh nhau */
    gap: 20px;
    max-height: 600px;
    overflow-y: auto;
    border: 1px solid #ccc;
    padding: 8px;
    background-color: white;
}
/* Responsive */
@media (max-width: 768px) {
    body {
        flex-direction: column; /* left-panel xu·ªëng tr√™n, right-panel-container xu·ªëng d∆∞·ªõi */
        align-items: center;
    }
    
    .right-panel {
        flex-direction: column; /* c·ªôt thanh m·∫´u v√† v·∫≠n m·∫´u r·ªõt xu·ªëng */
    }
}

@media (max-width: 480px) {
    body {
        flex-direction: column;
        align-items: center;
    }
    .right-panel-container {
        width: 100%;
    }
    .right-panel {
        flex-direction: column;
    }
    .column {
        width: 100%;
    }
}
/* M·ªói c·ªôt */
.column {
    width:220px; 
}

.column h3 {
    margin-top:0;
}

/* M·ªói item √¢m */
.phoneme-box {
    border:1px solid #ddd;
    padding:8px;
    margin-bottom:12px;
    border-radius:8px;
}

.phoneme-header {
    display:flex;
    justify-content:space-between;
    align-items:center;
}
.phoneme-box audio {
    display: none;
}
/* Style n√∫t Play m·ªõi */
.play-btn {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 3px 60px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
}

.play-btn:active {
    opacity: 0.7;
}
.phoneme-images {
    display: flex;          /* x·∫øp h√¨nh ngang */
    flex-wrap: wrap;        /* xu·ªëng h√†ng n·∫øu qu√° r·ªông */
    gap: 4px;
    width: 200px;           /* ho·∫∑c width mong mu·ªën */
    height: 100px;          /* chi·ªÅu cao khung */
    border: 1px solid #ddd; /* vi·ªÅn khung */
    padding: 4px;
    overflow: hidden;       /* ·∫©n ph·∫ßn tr√†n */
    justify-content: center; /* cƒÉn gi·ªØa h√¨nh n·∫øu mu·ªën */
    align-items: center;     /* cƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
}

.phoneme-images img {
    max-width: 100%;   /* kh√¥ng v∆∞·ª£t qu√° khung */
    max-height: 100%;  /* kh√¥ng v∆∞·ª£t qu√° khung */
    object-fit: contain; /* gi·ªØ t·ªâ l·ªá h√¨nh */
    flex: 1 1 auto;    /* co gi√£n n·∫øu c·∫ßn */
}
.tone-chart p {
    max-width: 200px;   /* GI·ªöI H·∫†N ƒê·ªò R·ªòNG */
    
    line-height: 1.4;   /* nh√¨n tho√°ng h∆°n */
}
canvas{border:1px solid #ccc;background:#fff;display:block;margin-bottom:8px;}
.controls{margin-bottom:12px;}
label{margin-right:8px;}
.correct { background-color: #c8ffcc !important; }
.wrong { background-color: #ffc8c8 !important; }
/* Footer */
    footer {      
      text-align: center;
    }
</style>
</head>
<body>
<div class="main-panels" style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap;">
<!-- LEFT: CANVAS + CONTROLS -->
<div class="left-panel">
    <p><a href="index.html" class="homepage-link">Home</a><p>
    <a href="index.html">
    <img src="assets/banner.png" alt="CHINESE 60s" style="width:500px; height:auto;">
</a>
    <h2>Mandarin Chinese Pronunciation Guide</h2>
    <canvas id="canvas" width="500" height="500"></canvas>

    <div class="controls">
      <select id="layerSelect">
        <option value="">--Select Layer--</option>
      </select>
      <label>Rotate: <span id="rotVal">0¬∞</span></label>
      <input type="range" id="rotSlider" min="-180" max="180" value="0">
      <input type="number" id="rotInput" min="-180" max="180" value="0" style="width:50px">
      <button id="resetBtn">Reset All</button>
      <br><br>
      <button id="setStartBtn">Set Keyframe Start</button>
      <button id="setEndBtn">Set Keyframe End</button>
      <button id="playBtn">Play</button>
      <button id="loopBtn">Loop On/Off</button>
    </div>

    <div>
      <p>PivotPixel: <span id="pivotPixel">N/A</span></p>
      <p>Anchor: <span id="anchorVal">N/A</span></p>
    </div>

</div>

<!-- RIGHT: 2 COLUMN PHONETICS -->
<div class="right-panel-container">
  <div class="pdf-ad">
    <h3>Mandarin Chinese pronunciation Training Pack</h3>
    <div class="pdf-item">
      <img src="https://res.cloudinary.com/dndwvsqib/image/upload/v1764303120/pronunciation-ad-2_qu8u0o.png" alt="PDF Cover" style="width:500px;height:auto;">
      <div>
        <p><a href="https://example.com/buy-pdf" target="_blank">BUY NOW!!!</a></p>
      </div>
    </div>
  </div>
<div class="right-panel">
  
    <!-- COLUMN 1: Thanh m·∫´u -->
    <div class="column">
        <h3>Initials</h3>

        <!-- M·∫´u demo, m√†y th√™m bao nhi√™u t√πy th√≠ch -->
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>b</strong>
                <audio controls src="yuyin/audio/b.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/b.png">
                
            </div>
        </div>

        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>p</strong>
                <audio controls src="yuyin/audio/p.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/p.png">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>m</strong>
                <audio controls src="yuyin/audio/m.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/m.gif">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>f</strong>
                <audio controls src="yuyin/audio/f.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/f.gif">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>d</strong>
                <audio controls src="yuyin/audio/d.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/d.gif">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>t</strong>
                <audio controls src="yuyin/audio/t.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/t.gif">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>n</strong>
                <audio controls src="yuyin/audio/n.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/n.gif">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>l</strong>
                <audio controls src="yuyin/audio/l.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/l.gif">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>g</strong>
                <audio controls src="yuyin/audio/g.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/g.gif">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>k</strong>
                <audio controls src="yuyin/audio/k.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/k.jpg">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>h</strong>
                <audio controls src="yuyin/audio/h.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/h.jpg">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>j</strong>
                <audio controls src="yuyin/audio/j.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/j.gif">
                
            </div>
        </div>

        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>q</strong>
                <audio controls src="yuyin/audio/q.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/q.gif">
                
            </div>
        </div>

        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>x</strong>
                <audio controls src="yuyin/audio/x.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/x.gif">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>z</strong>
                <audio controls src="yuyin/audio/z.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/zcs.png">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>c</strong>
                <audio controls src="yuyin/audio/c.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/zcs.png">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>s</strong>
                <audio controls src="yuyin/audio/s.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/zcs.png">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>zh</strong>
                <audio controls src="yuyin/audio/zh.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/zh.gif">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>ch</strong>
                <audio controls src="yuyin/audio/ch.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/ch.gif">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>sh</strong>
                <audio controls src="yuyin/audio/sh.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/sh.gif">
                
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>r</strong>
                <audio controls src="yuyin/audio/r.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/r.jpg">
                
            </div>
        </div>
    </div>

    <!-- COLUMN 2: V·∫≠n m·∫´u -->
    <div class="column">
        <h3>Finals</h3>

        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>a</strong>
            <audio controls src="yuyin/audio/a.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/a.jpg">
                
            </div>
        </div>

        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>o</strong>
            <audio controls src="yuyin/audio/o.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/o.jpg">
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>e</strong>
            <audio controls src="yuyin/audio/e.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/e.jpg">
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>i</strong>
            <audio controls src="yuyin/audio/i.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/i.jpg">
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>u</strong>
            <audio controls src="yuyin/audio/u.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/u.jpg">
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>√º</strong>
            <audio controls src="yuyin/audio/u2.mp3"></audio>
            </div>
            <div class="phoneme-images">
                <img src="yuyin/u2.gif">
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>ai</strong>
            <audio controls src="yuyin/audio/ai.mp3"></audio>
            </div>
            
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>ei</strong>
            <audio controls src="yuyin/audio/ei.mp3"></audio>
            </div>
            
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>ao</strong>
            <audio controls src="yuyin/audio/ao.mp3"></audio>
            </div>
            
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>ou</strong>
            <audio controls src="yuyin/audio/ou.mp3"></audio>
            </div>
            
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>an</strong>
            <audio controls src="yuyin/audio/an.mp3"></audio>
            </div>
            
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>en</strong>
            <audio controls src="yuyin/audio/en.mp3"></audio>
            </div>
            
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>ang</strong>
            <audio controls src="yuyin/audio/ang.mp3"></audio>
            </div>
            
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>eng</strong>
            <audio controls src="yuyin/audio/eng.mp3"></audio>
            </div>
            
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>ong</strong>
            <audio controls src="yuyin/audio/ong.mp3"></audio>
            </div>
            
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>ia</strong>
            <audio controls src="yuyin/audio/ia.mp3"></audio>
            </div>
            <div>
                <strong>/ya/</strong>
            </div>
            
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>ie</strong>
            <audio controls src="yuyin/audio/ie.mp3"></audio>
            </div>
            <div>
                <strong>/ye/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>iao</strong>
            <audio controls src="yuyin/audio/iao.mp3"></audio>
            </div>
            <div>
                <strong>/yao/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>iu (iou)</strong>
            <audio controls src="yuyin/audio/iu (iou).mp3"></audio>
            </div>
            <div>
                <strong>/you/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>ian</strong>
            <audio controls src="yuyin/audio/ian.mp3"></audio>
            </div>
            <div>
                <strong>/yan/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>in</strong>
            <audio controls src="yuyin/audio/in.mp3"></audio>
            </div>
            <div>
                <strong>/yin/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>iang</strong>
            <audio controls src="yuyin/audio/iang.mp3"></audio>
            </div>
            <div>
                <strong>/yang/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>ing</strong>
            <audio controls src="yuyin/audio/ing.mp3"></audio>
            </div>
            <div>
                <strong>/ying/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>√ºe</strong>
            <audio controls src="yuyin/audio/√ºe.mp3"></audio>
            </div>
            <div>
                <strong>/yue/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>√ºan</strong>
            <audio controls src="yuyin/audio/√ºan.mp3"></audio>
            </div>
            <div>
                <strong>/yuan/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>√ºn</strong>
            <audio controls src="yuyin/audio/√ºn.mp3"></audio>
            </div>
            <div>
                <strong>/yun/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>iong</strong>
            <audio controls src="yuyin/audio/iong.mp3"></audio>
            </div>
            <div>
                <strong>/yong/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>-i</strong>
            <audio controls src="yuyin/audio/-i.mp3"></audio>
            </div>
            
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>er</strong>
            <audio controls src="yuyin/audio/er.mp3"></audio>
            </div>
            
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>ua</strong>
            <audio controls src="yuyin/audio/ua.mp3"></audio>
            </div>
            <div>
                <strong>/wa/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>uo</strong>
            <audio controls src="yuyin/audio/uo.mp3"></audio>
            </div>
            <div>
                <strong>/wo/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>uai</strong>
            <audio controls src="yuyin/audio/uai.mp3"></audio>
            </div>
            <div>
                <strong>/wai/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>ui (uei)</strong>
            <audio controls src="yuyin/audio/ui (uei).mp3"></audio>
            </div>
            <div>
                <strong>/wei/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>uan</strong>
            <audio controls src="yuyin/audio/uan.mp3"></audio>
            </div>
            <div>
                <strong>/wan/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>un (uen)</strong>
            <audio controls src="yuyin/audio/un (uen).mp3"></audio>
            </div>
            <div>
                <strong>/wen/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>uang</strong>
            <audio controls src="yuyin/audio/uang.mp3"></audio>
            </div>
            <div>
                <strong>/wang/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>ueng</strong>
            <audio controls src="yuyin/audio/ueng.mp3"></audio>
            </div>
            <div>
                <strong>/weng/</strong>
            </div>
        </div>
        <div class="phoneme-box">
            <div class="phoneme-header">
                <strong>-i[∆™]</strong>
            <audio controls src="yuyin/audio/-i[∆™].mp3"></audio>
            </div>
            
        </div>
        
</div>
<div class="tone-chart">
    <h3>Tones</h3>
    <img src="yuyin/tones.gif" alt="B·∫£ng thanh ƒëi·ªáu" style="width:100%;">
    <p>Some syllables in Chinese are toneless (disregarding the tones of the characters they represent) and are pronounced light and short. These syllables are called neutralized tones or neutral tones. The pitch of a neutral tone is affected by the tone of the preceding syllable.</p>
    <p> 3rd tone + 1st tone/2nd tone/4th tone/neutral tone-> 3rd-tone syllable becomes a half 3rd tone</p>
    <p> ‰∏ç(4th tone) + 4th tone syllable-> ‰∏ç changes to the 2nd tone</p>
    <p> ‰∏Ä+ the 1st, 2nd or 3rd tone syllables-> ‰∏Ä is pronounced as the 4th tonee</p>
    <p> ‰∏Ä+ the 4th tone syllables -> ‰∏Ä is pronounced as the 2nd tone</p>
    <p> 3rd tone + 3rd tone + 3rd tone -> 2nd tone + 2nd tone + 3rd tone</p>
    <p> 3rd tone + 3rd tone + 3rd tone -> 3rd tone + 2nd tone + 3rd tone</p>
    <h3>PDF for learning<br>Mandarin Chinese<br>pronunciation</h3>
    <img src="https://res.cloudinary.com/dndwvsqib/image/upload/v1764303120/pronunciation-ad-2_qu8u0o.png" alt="PDF Cover" style="width:250px;height:auto;">
    <p><a href="https://example.com/buy-pdf" target="_blank">BUY NOW!!!</a></p>
</div>
</div>
</div>
<!-- =================== QUIZ SECTION (T√ÅCH RI√äNG) =================== -->
  <div class="quiz-section" style="margin-top:40px; width:90%; max-width:1200px; border:1px solid #ccc; padding:20px; background:white;">
    <h2>Quiz Section</h2>
    <h3>Listen to the following initials and finals and choose the correct answer</h3>
    <table id="quiz-grid-mcq1"></table>

    <h3>Distinguish easily confused tones</h3>
    <table id="quiz-grid-mcq2"></table>

    <h3>Choose the correct tone based on the tone-change rules</h3>
    <table id="quiz-grid-tone"></table>

    <h3>Fill in the blanks with multi-syllable phrases</h3>
    <p>Type the pinyin following these rules: ƒÅ = a1;  √° = a2; «é = a3; √† = a4; √º = v</p>
    <table id="quiz-grid-fillin"></table>
<!-- Button xem to√†n b·ªô -->
<div style="margin-top:20px;">
    <a href="yuyin-quiz_full.html">
        <button style="padding:10px 20px; font-size:16px;">Do all the quizzes here!</button>
    </a>
</div>
  </div>

<!-- Footer -->
  <footer>
    <p>Chinese60s</p>
    <p>Learn Mandarin through images and videos</p>
    <div class="social-icons">
      <a href="#">Facebook</a>
      <a href="#">YouTube</a>
      <a href="#">TikTok</a>
      <a href="#">Instagram</a>
    </div>
  </footer>
<script>
// Map thanh ƒëi·ªáu
const toneMap = {
    a: ["ƒÅ","√°","«é","√†"],
    e: ["ƒì","√©","ƒõ","√®"],
    i: ["ƒ´","√≠","«ê","√¨"],
    o: ["≈ç","√≥","«í","√≤"],
    u: ["≈´","√∫","«î","√π"],
    √º: ["«ñ","«ò","«ö","«ú"]
};

// H√†m convert ch√≠nh
function convertPinyin(str) {
    // ƒë·ªïi "v" ‚Üí "√º"
    str = str.replace(/v/g, "√º");

    return str.replace(/([a-z√º]+)([1-4])/gi, (match, letters, tone) => {
        const t = parseInt(tone) - 1;
        letters = letters.toLowerCase();

        // th·ª© t·ª± ∆∞u ti√™n ƒë·∫∑t d·∫•u
        const priority = ["a","e","o","u","i","√º"];

        for (let v of priority) {
            const idx = letters.indexOf(v);
            if (idx !== -1) {
                const accented = toneMap[v][t];
                return (
                    letters.slice(0, idx) +
                    accented +
                    letters.slice(idx + v.length)
                );
            }
        }

        return match;
    });
}

// √Åp d·ª•ng v√†o input .pinyin-input
document.addEventListener("input", (e) => {
    if (e.target.classList.contains("pinyin-input")) {
        const pos = e.target.selectionStart;
        e.target.value = convertPinyin(e.target.value);
        e.target.setSelectionRange(pos, pos);
    }
});
</script>

<script>
async function loadAllGrids() {
    const res = await fetch("data/yuyin-preview.json");
    const data = await res.json();

    const tables = [
        {id: "quiz-grid-mcq1", group: "mcq1"},
        {id: "quiz-grid-mcq2", group: "mcq2"},
        {id: "quiz-grid-tone", group: "tone"},
        {id: "quiz-grid-fillin", group: "fill"}
    ];

    tables.forEach(t => renderGrid(data, t.id, t.group));
}

function renderGrid(data, tableId, group) {
    const table = document.getElementById(tableId);
    const COLUMNS = 3;
    let row;

    data.filter(q => q.group === group).forEach((q, index) => {

        if (index % COLUMNS === 0) {
            row = document.createElement("tr");
            table.appendChild(row);
        }

        const cell = document.createElement("td");

        /* ------------------ MULTIPLE CHOICE ------------------ */
        if (q.type === "choice") {
            cell.dataset.answer = q.answer;
            cell.innerHTML = `
                <div class="cell-buttons">
                    <button onclick="playAudio('${q.audio}')">üîä</button>
                    <button onclick="checkAnswer(this,0)">${q.options[0]}</button>
                    <button onclick="checkAnswer(this,1)">${q.options[1]}</button>
                </div>
            `;
        }

        /* ------------------ TONE TYPE (2‚Äì3 c·ª•m) ------------------ */
        else if (q.type === "tone") {
            cell.dataset.tone1 = q.tone1;
            cell.dataset.tone2 = q.tone2;
            if (q.text3 && q.tone3 !== undefined) cell.dataset.tone3 = q.tone3;

            let html = `
                <div class="cell-area">
                    <button onclick="playAudio('${q.audio}')">üîä</button>
                    <span>${q.text1}</span>
                    <select class="select1">
                        <option value="">-</option><option value="1">1</option>
                        <option value="2">2</option><option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                    <span>${q.text2}</span>
                    <select class="select2">
                        <option value="">-</option><option value="1">1</option>
                        <option value="2">2</option><option value="3">3</option>
                        <option value="4">4</option>
                    </select>
            `;

            if (q.text3 && q.tone3 !== undefined) {
                html += `
                    <span>${q.text3}</span>
                    <select class="select3">
                        <option value="">-</option><option value="1">1</option>
                        <option value="2">2</option><option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                `;
            }

            html += `<button onclick="checkTone(this)">Check</button></div>`;
            cell.innerHTML = html;
        }

        /* ------------------ FILL-IN INPUT TYPE ------------------ */
        else if (q.type === "fill") {
            cell.dataset.answer = q.answer;

            cell.innerHTML = `
                <div class="cell-area">
                    <button onclick="playAudio('${q.audio}')">üîä</button>
                    <input type="text" class="pinyin-input fill-input" placeholder="Type the word you hear">
                    <button onclick="checkFill(this)">Check</button>
                </div>
            `;
        }

        row.appendChild(cell);
    });
}

/* ------------------ AUDIO ------------------ */
function playAudio(file) {
    new Audio(file).play();
}

/* ------------------ MCQ CHECK ------------------ */
function checkAnswer(btn, choice) {
    const cell = btn.closest("td");
    const correct = Number(cell.dataset.answer);

    cell.querySelectorAll("button").forEach(b => b.classList.remove("correct","wrong"));
    btn.classList.add(choice===correct ? "correct" : "wrong");
}

/* ------------------ TONE CHECK ------------------ */
function checkTone(btn) {
    const cell = btn.closest("td");

    const correct1 = Number(cell.dataset.tone1);
    const correct2 = Number(cell.dataset.tone2);
    const correct3 = cell.dataset.tone3 ? Number(cell.dataset.tone3) : null;

    const v1 = Number(cell.querySelector(".select1").value);
    const v2 = Number(cell.querySelector(".select2").value);
    const v3 = correct3 !== null ? Number(cell.querySelector(".select3").value) : null;

    cell.classList.remove("correct","wrong");

    let isOK = (v1 === correct1 && v2 === correct2);
    if (correct3 !== null) isOK = isOK && (v3 === correct3);

    cell.classList.add(isOK ? "correct" : "wrong");
}

/* ------------------ FILL-IN CHECK ------------------ */
// Normalize pinyin: ƒë·ªïi v‚Üí√º, convert tone numbers, th·ªëng nh·∫•t d·∫°ng c√≥ d·∫•u
function normalizePinyin(str) {
    if (!str) return "";
    str = str.toLowerCase().trim();
    str = str.replace(/\s+/g, ""); // ‚ùó b·ªè to√†n b·ªô d·∫•u c√°ch
    return convertPinyin(str);     // gi·ªØ nguy√™n h√†m convertPinyin c·ªßa m√†y
}
function checkFill(btn) {
    const cell = btn.closest("td");

    const inputRaw = cell.querySelector(".fill-input").value;
    const correctRaw = cell.dataset.answer;

    const input = normalizePinyin(inputRaw);
    const correct = normalizePinyin(correctRaw);

    // Reset class
    cell.classList.remove("correct","wrong");

    // N·∫øu ƒë√∫ng
    if (input === correct) {
        cell.classList.add("correct");
        cell.dataset.wrongCount = 0;  // reset wrong count
        const ansBox = cell.querySelector(".answer-box");
        if (ansBox) ansBox.remove();
        return;
    }

    // N·∫øu sai
    cell.classList.add("wrong");

    // TƒÉng b·ªô ƒë·∫øm sai
    let count = Number(cell.dataset.wrongCount || 0) + 1;
    cell.dataset.wrongCount = count;

    // N·∫øu sai < 3 ‚Üí kh√¥ng show ƒë√°p √°n
    if (count < 3) return;

    // N·∫øu sai ‚â• 3 l·∫ßn ‚Üí hi·ªán ƒë√°p √°n
    if (!cell.querySelector(".answer-box")) {
        const correctDisplay = cell.dataset.answer; // gi·ªØ nguy√™n format c·ªßa m√†y

        const box = document.createElement("div");
        box.className = "answer-box";
        box.style.marginTop = "6px";
        box.style.fontSize = "14px";
        box.style.color = "#333";

        box.innerHTML = `Answer: <b>${correctDisplay}</b>`;

        cell.appendChild(box);
    }
}
loadAllGrids();
</script>

<!-- ======================= SCRIPT RIG =============================== -->
<script>
/* ‚Äî‚Äî TO√ÄN B·ªò PH·∫¶N JS C·ª¶A M√ÄY GI·ªÆ NGUY√äN ‚Äî‚Äî */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const layerSelect = document.getElementById('layerSelect');
const rotSlider = document.getElementById('rotSlider');
const rotInput = document.getElementById('rotInput');
const rotVal = document.getElementById('rotVal');
const resetBtn = document.getElementById('resetBtn');
const setStartBtn = document.getElementById('setStartBtn');
const setEndBtn = document.getElementById('setEndBtn');
const playBtn = document.getElementById('playBtn');
const loopBtn = document.getElementById('loopBtn');
const pivotPixelEl = document.getElementById('pivotPixel');
const anchorEl = document.getElementById('anchorVal');

const CANVAS_WIDTH = canvas.width;
const CANVAS_HEIGHT = canvas.height;
const ORIGINAL_IMG_SIZE = 1080;
const SCALE = Math.min(CANVAS_WIDTH/ORIGINAL_IMG_SIZE, CANVAS_HEIGHT/ORIGINAL_IMG_SIZE);

let selectedLayer = null;
let layers = [
  {name:'background', src:'yuyin/images/background.png', pivotX:540, pivotY:540, fixed:true},
  {name:'frame', src:'yuyin/images/frame.png', pivotX:540, pivotY:540, fixed:true},
  {name:'back-tongue', src:'yuyin/images/back-tongue.png', pivotX:540, pivotY:540, fixed:true},
  {name:'lower-jaw', src:'yuyin/images/lower-jaw.png', pivotX:412, pivotY:728, parent:'back-tongue'},
  {name:'blade-back', src:'yuyin/images/back-blade.png', pivotX:572, pivotY:587, parent:'back-tongue'},
  {name:'blade-top', src:'yuyin/images/top-blade.png', pivotX:490, pivotY:585, parent:'blade-back'},
  {name:'tip-tongue', src:'yuyin/images/tip-tongue.png', pivotX:399, pivotY:580, parent:'blade-top'},
  {name:'lower-lip', src:'yuyin/images/lower-lip.png', pivotX:215, pivotY:659, parent:'lower-jaw'},
  {name:'hard-palate', src:'yuyin/images/hard-palate.png', pivotX:595, pivotY:485,  fixed:false},
  {name:'soft-palate', src:'yuyin/images/soft-palate.png', pivotX:540, pivotY:540, parent:'hard-palate'},
  {name:'upper-lip', src:'yuyin/images/upper-lip.png', pivotX:205, pivotY:530, parent:'hard-palate'},
  {name:'uvula', src:'yuyin/images/uvula.png', pivotX:599, pivotY:485, parent:'soft-palate'},
];

// Animation
let keyframes = [];
let totalFrames = 24;
let animating = false;
let loop = false;
let currentFrame = 0;

// Load images
function loadAllLayers(){
  let loaded = 0;
  layers.forEach(l=>{
    const img = new Image();
    img.src = l.src;
    img.onload = ()=>{
      l.img = img;
      l.width = img.width;
      l.height = img.height;
      l.scale = SCALE;
      l.rotation = 0;
      const originX = CANVAS_WIDTH / 2;
      const originY = CANVAS_HEIGHT / 2;
      l.x = originX + (l.pivotX - 540) * SCALE;
      l.y = originY + (l.pivotY - 540) * SCALE;
      l.initX = l.x; l.initY = l.y; l.initRotation = l.rotation;
      loaded++;
      if(loaded===layers.length){ populateLayerSelect(); drawAll(); }
    }
  });
}

// Populate select
function populateLayerSelect(){
  layerSelect.innerHTML = '<option value="">--Select Layer--</option>';
  layers.forEach(l=>{
    if(!l.fixed){
      const opt = document.createElement('option');
      opt.value = l.name;
      opt.textContent = l.name;
      layerSelect.appendChild(opt);
    }
  });
}

// Update child positions
function updateChildPositions(parent){
  layers.forEach(l=>{
    if(l.parent === parent.name){
      const dx0 = l.initX - parent.initX;
      const dy0 = l.initY - parent.initY;
      const cos = Math.cos(parent.rotation);
      const sin = Math.sin(parent.rotation);
      const newDx = dx0 * cos - dy0 * sin;
      const newDy = dx0 * sin + dy0 * cos;
      l.x = parent.x + newDx;
      l.y = parent.y + newDy;
      l.rotation = parent.rotation + l.initRotation;
      updateChildPositions(l);
    }
  });
}

// Draw all
function drawAll(){
  ctx.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);
  layers.forEach(l=>{
    if(!l.img) return;
    ctx.save();
    ctx.translate(l.x,l.y);
    ctx.rotate(l.rotation);
    ctx.drawImage(l.img,-l.pivotX*l.scale,-l.pivotY*l.scale,l.width*l.scale,l.height*l.scale);
    ctx.restore();
  });
  updateInfo();
}

// Update info
function updateInfo(){
  if(!selectedLayer){ pivotPixelEl.textContent='N/A'; anchorEl.textContent='N/A'; return; }
  pivotPixelEl.textContent=`${selectedLayer.pivotX}, ${selectedLayer.pivotY}`;
  anchorEl.textContent=`${(selectedLayer.pivotX/selectedLayer.width).toFixed(4)}, ${(selectedLayer.pivotY/selectedLayer.height).toFixed(4)}`;
}

// Event listeners
layerSelect.addEventListener('change', ()=>{
  selectedLayer = layers.find(l=>l.name===layerSelect.value);
  if(selectedLayer){
    const deg = Math.round(selectedLayer.rotation*180/Math.PI);
    rotSlider.value = deg;
    rotInput.value = deg;       // ƒë·ªìng b·ªô √¥ input
    rotVal.textContent = deg+'¬∞';
    updateInfo();
  }
});

rotSlider.addEventListener('input', ()=>{
  if(!selectedLayer) return;
  const deg = Number(rotSlider.value);
  selectedLayer.rotation = deg * Math.PI/180;
  rotInput.value = deg;       // ƒë·ªìng b·ªô √¥ input
  rotVal.textContent = deg+'¬∞';
  updateChildPositions(selectedLayer);
  drawAll();
});
rotInput.addEventListener('change', ()=>{
  if(!selectedLayer) return;
  let deg = Number(rotInput.value);
  if(isNaN(deg)) deg = 0;
  rotInput.value = deg;        // ƒë·∫£m b·∫£o gi√° tr·ªã h·ª£p l·ªá
  selectedLayer.rotation = deg * Math.PI/180;
  rotSlider.value = deg;       // ƒë·ªìng b·ªô slider
  rotVal.textContent = deg+'¬∞';
  updateChildPositions(selectedLayer);
  drawAll();
});
resetBtn.addEventListener('click', ()=>{
  layers.forEach(l=>{l.rotation=l.initRotation;l.x=l.initX;l.y=l.initY;});
  drawAll();
// Reset m√†u c√°c n√∫t keyframe v·ªÅ m·∫∑c ƒë·ªãnh
  setStartBtn.style.background = '';
  setStartBtn.style.color = '';
  setEndBtn.style.background = '';
  setEndBtn.style.color = '';
});

// Keyframe buttons
setStartBtn.addEventListener('click', ()=>{saveKeyframe(0, setStartBtn);});
setEndBtn.addEventListener('click', ()=>{saveKeyframe(12, setEndBtn);});

function saveKeyframe(frame, btn){
  keyframes[frame] = layers.map(l=>({name:l.name,x:l.x,y:l.y,rotation:l.rotation}));
  
  // Khi ƒë√£ set xong, ƒë·ªïi m√†u n√∫t ƒë·ªÉ bi·∫øt
  btn.style.background = '#4CAF50';  // xanh l√°
  btn.style.color = 'white';
}

// Interpolate frames
function interpolateKeyframes(){
  // N·ªôi suy frame t·ª´ 1 ƒë·∫øn 11
  for(let f = 1; f < 12; f++){
    keyframes[f] = layers.map(l => {
      const start = keyframes[0].find(k => k.name === l.name);
      const end   = keyframes[12].find(k => k.name === l.name);
      const t = f / 12;
      return {
        name: l.name,
        x: start.x + (end.x - start.x) * t,
        y: start.y + (end.y - start.y) * t,
        rotation: start.rotation + (end.rotation - start.rotation) * t
      };
    });
  }

  // Frame 12 = keyframe end (ƒë√£ c√≥ s·∫µn)

  // Frame 13-23: gi·ªØ nguy√™n frame 12 (ƒë·ªÉ animation k·∫øt th√∫c y√™n)
  for(let f = 13; f < 24; f++){
    keyframes[f] = keyframes[12].map(v => ({...v}));
  }
}
// Play animation
playBtn.addEventListener('click',()=>{
  if(!keyframes[0]||!keyframes[12]){alert('Set both start and end keyframes!'); return;}
  interpolateKeyframes();
  animating = true;
  currentFrame = 0;
  requestAnimationFrame(playAnim);
});

loopBtn.addEventListener('click',()=>{loop=!loop; alert('Loop: '+loop);});

let lastTime = 0;
const FPS = 24;                // FPS mong mu·ªën
const frameDuration = 1000/FPS;
function playAnim(timestamp) {
  if (!animating) return;

  if (timestamp - lastTime >= frameDuration) {
    lastTime = timestamp;

    // c·∫≠p nh·∫≠t frame
    const frameData = keyframes[currentFrame];
    frameData.forEach(fd => {
      const l = layers.find(ly => ly.name === fd.name);
      l.x = fd.x; l.y = fd.y; l.rotation = fd.rotation;
    });

    drawAll();

    currentFrame++;
    if (currentFrame >= 24) {
      if (loop) currentFrame = 0;
      else { animating = false; return; }
    }
  }

  requestAnimationFrame(playAnim);
}
// Start
loadAllLayers();

</script>
<script>
window.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".phoneme-box").forEach(box => 
        box.querySelector(".phoneme-header").appendChild(
            Object.assign(document.createElement("button"), {
                className: "play-btn",
                textContent: "‚ñ∫ Play",
                onclick: () => box.querySelector("audio")?.play()
            })
        )
    );
});
</script>
</body>
</html>













