<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tone Game</title>
<style>
body {
  font-family: sans-serif;
  background: linear-gradient(135deg, #ffe7ba, #ffe1ee);
  text-align: center;
  padding: 40px;
}

h1 { font-size: 36px; }

#lesson-select {
  font-size: 20px;
  padding: 8px 12px;
  margin-bottom: 20px;
}

#play-btn {
  padding: 10px 20px;
  font-size: 18px;
  margin-bottom: 20px;
  cursor: pointer;
}

.tones {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  justify-content: center;
  margin-top: 20px;
}

.tone-btn {
  padding: 20px 28px;
  font-size: 28px;
  background: #fff;
  border-radius: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  cursor: pointer;
  transition: transform 0.1s;
  user-select: none;
}

.tone-btn:hover { transform: scale(1.1); }

#popup {
  margin-top: 20px;
  font-size: 48px;
  font-weight: bold;
  opacity: 0;
  transform: translateY(0) scale(0.8);
  transition: all 0.3s ease-out;
  display: inline-block;
  padding: 10px 30px;
  border-radius: 25px;
  color: white;
}

#popup.show {
  opacity: 1;
  transform: translateY(-20px) scale(1);
}

.sparkle {
  position: fixed;
  font-size: 40px;
  animation: fly 1s ease-out forwards;
}

@keyframes fly {
  0%   { transform: translateY(0) scale(1); opacity: 1; }
  100% { transform: translateY(-150px) scale(0.3); opacity: 0; }
}

#summary {
  margin-top: 30px;
  font-size: 24px;
}

/* Lock Screen Styles */
#locked-section {
  max-width: 400px;
  margin: 100px auto;
  padding: 30px 20px;
  background-color: #f7f7f7;
  border: 2px solid #8bc34a;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
  text-align: center;
  font-family: Arial, sans-serif;
}

#locked-section h2 {
  margin-bottom: 20px;
  font-size: 20px;
  color: #333;
}

#locked-section input {
  width: 80%;
  padding: 10px;
  font-size: 16px;
  margin-bottom: 15px;
  border: 1px solid #ccc;
  border-radius: 6px;
  box-sizing: border-box;
}

#locked-section button {
  padding: 10px 25px;
  font-size: 16px;
  background-color: #8bc34a;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.3s;
}

#locked-section button:hover {
  background-color: #7cb342;
}

#locked-section #status {
  margin-top: 15px;
  color: red;
  font-weight: bold;
}

/* Hide game content initially */
#game-content {
  display: none;
}
</style>
</head>
<body>

<!-- Lock Screen -->
<div id="locked-section">
  <h2>Enter the license key to play the game</h2>
  <input id="licenseInput" type="text" placeholder="Enter license key...">
  <button id="verifyBtn">Unlock</button>
  <p id="status"></p>
  <a href="https://maxfilms.gumroad.com/l/mandarin-pronunciation-pack" 
       target="_blank" 
       style="color:#0073ff; text-decoration:underline; font-weight:bold;">
      Purchase the Mandarin Pronunciation Training Pack to get your license key
  </a>
</div>

<!-- Game Content -->
<div id="game-content">
  <h1>ðŸŽµ Tone Practice Game</h1>

  <select id="lesson-select">
    <option value="0">Select a lesson</option>
  </select>
  <br>
  <button id="play-btn">â–¶ Play Audio</button>

  <div class="tones" id="tone-buttons"></div>

  <div id="popup"></div>
  <div id="summary"></div>
</div>

<script>
// ==================== LICENSE VERIFICATION ====================
const PRODUCT_ID = "ufowKPN1xaOa-ueREQbmOw==";

// Check if already unlocked
if (localStorage.getItem("unlocked") === "yes") {
    document.getElementById("locked-section").style.display = "none";
    document.getElementById("game-content").style.display = "block";
}

// Verify license key
document.getElementById("verifyBtn").addEventListener("click", async function () {
    const key = document.getElementById("licenseInput").value.trim();
    const status = document.getElementById("status");

    if (!key) {
        status.textContent = "Please enter a valid license key.";
        return;
    }

    status.textContent = "Checking...";

    const form = new URLSearchParams();
    form.append("product_id", PRODUCT_ID);
    form.append("license_key", key);

    try {
        const response = await fetch("https://api.gumroad.com/v2/licenses/verify", {
            method: "POST",
            body: form
        });

        const data = await response.json();
        console.log("Response:", data);

        if (data.success) {
            localStorage.setItem("unlocked", "yes");
            document.getElementById("locked-section").style.display = "none";
            document.getElementById("game-content").style.display = "block";
            status.textContent = "";
        } else {
            status.textContent = "Invalid license key.";
        }
    } catch (error) {
        console.error("Error:", error);
        status.textContent = "Connection error. Please try again.";
    }
});

// ==================== GAME LOGIC ====================
const lessons = [
  {id:1, title:"Easy â€” 15 tones", audio:"https://res.cloudinary.com/dndwvsqib/video/upload/v1764554031/level-1_pings3.mp3", sequence:["mÃ¡","mÃ ","mÃ¡","mÇŽ","mÄ","mÃ ","mÃ ","mÃ¡","mÇŽ","mÇŽ","mÄ","mÃ¡","mÃ ","mÇŽ","mÄ"]},
  {id:2, title:"Light Easy â€” 30 tones", audio:"https://res.cloudinary.com/dndwvsqib/video/upload/v1764554041/level-2_u5215m.mp3", sequence:["mÇŽ","mÃ ","mÄ","mÃ¡","mÄ","mÃ ","mÃ¡","mÇŽ","mÇŽ","mÃ ","mÃ ","mÄ","mÃ¡","mÄ","mÇŽ","mÇŽ","mÃ ","mÃ¡","mÄ","mÄ","mÃ¡","mÇŽ","mÃ ","mÇŽ","mÃ¡","mÃ ","mÄ","mÇŽ","mÃ¡","mÃ "]},
  {id:3, title:"Medium â€” 45 tones", audio:"https://res.cloudinary.com/dndwvsqib/video/upload/v1764554042/level-3_fgzabw.mp3", sequence:["mÃ ","mÇŽ","mÃ¡","mÄ","mÇŽ","mÃ ","mÃ¡","mÄ","mÇŽ","mÃ¡","mÃ ","mÃ ","mÇŽ","mÇŽ","mÄ","mÃ¡","mÄ","mÃ ","mÇŽ","mÃ¡","mÄ","mÄ","mÇŽ","mÃ¡","mÃ ","mÇŽ","mÃ¡","mÄ","mÃ ","mÇŽ","mÃ¡","mÄ","mÃ ","mÇŽ","mÇŽ","mÄ","mÃ¡","mÃ ","mÇŽ","mÄ","mÃ¡", "mÃ¡","mÄ", "mÇŽ", "mÃ "]},
  {id:4, title:"Hard-ish â€” 60 tones", audio:"https://res.cloudinary.com/dndwvsqib/video/upload/v1764554043/level-4_lfcwsz.mp3", sequence:["mÇŽ","mÃ ","mÃ ","mÃ¡","mÄ","mÇŽ","mÃ¡","mÃ ","mÄ","mÇŽ","mÃ¡","mÇŽ","mÃ ","mÄ","mÃ¡","mÃ ","mÇŽ","mÇŽ","mÄ","mÃ¡","mÃ ","mÄ","mÇŽ","mÃ¡","mÃ ","mÄ","mÇŽ","mÃ¡","mÃ ","mÄ","mÇŽ","mÃ¡","mÃ ","mÇŽ","mÄ","mÄ","mÇŽ","mÃ¡","mÃ ","mÇŽ","mÄ","mÃ ","mÇŽ","mÄ", "mÇŽ","mÄ","mÃ¡","mÃ ","mÄ","mÇŽ","mÃ¡","mÃ ","mÄ","mÇŽ", "mÃ ","mÃ¡","mÄ","mÇŽ","mÃ¡","mÃ "]},
  {id:5, title:"Hard â€” 100 tones", audio:"https://res.cloudinary.com/dndwvsqib/video/upload/v1764554046/level-5_cnffb4.mp3", sequence:["mÃ ","mÇŽ","mÃ¡","mÄ","mÇŽ","mÃ ","mÃ¡","mÇŽ","mÄ","mÃ ","mÇŽ","mÇŽ","mÄ","mÃ¡","mÃ ","mÄ","mÇŽ","mÃ¡","mÃ ","mÇŽ","mÃ ","mÄ","mÇŽ","mÃ¡","mÃ ","mÄ","mÃ¡","mÃ ","mÇŽ","mÇŽ","mÄ","mÃ¡","mÃ ","mÇŽ","mÄ","mÃ ","mÄ","mÇŽ","mÃ¡","mÃ ","mÇŽ","mÄ","mÄ","mÇŽ","mÃ¡","mÃ ","mÇŽ","mÄ","mÄ","mÇŽ","mÃ¡","mÃ ","mÇŽ","mÄ","mÃ ","mÇŽ","mÃ¡","mÄ","mÃ ","mÇŽ","mÄ","mÃ¡","mÃ ","mÇŽ","mÇŽ","mÃ ","mÄ","mÇŽ","mÃ¡","mÃ ","mÄ","mÇŽ","mÃ¡","mÃ ","mÇŽ","mÄ","mÄ","mÇŽ","mÄ","mÃ ","mÇŽ","mÃ¡","mÃ ","mÄ","mÇŽ","mÃ¡","mÃ ","mÇŽ","mÄ","mÃ¡", "mÇŽ","mÇŽ","mÄ","mÃ¡","mÃ ","mÇŽ","mÄ","mÃ ","mÄ","mÇŽ"]}
];

const popup = document.getElementById("popup");
const toneButtonsDiv = document.getElementById("tone-buttons");
const summaryDiv = document.getElementById("summary");
const lessonSelect = document.getElementById("lesson-select");
const playBtn = document.getElementById("play-btn");

let currentLesson = null;
let currentIndex = 0;
let errors = 0;
let audio = new Audio();

lessons.forEach((l,i)=>lessonSelect.innerHTML += `<option value="${i}">${l.title}</option>`);

lessonSelect.addEventListener("change", () => {
  const idx = Number(lessonSelect.value);
  if (idx < 0 || idx >= lessons.length) return;
  startLesson(lessons[idx]);
});

playBtn.addEventListener("click",()=>{
  if(currentLesson){
    audio.currentTime = 0;
    audio.play();
    if(currentIndex >= currentLesson.sequence.length){
      currentIndex = 0;
      errors = 0;
      summaryDiv.innerText = "";
    }
  }
});

function startLesson(lesson){
  currentLesson = lesson;
  currentIndex = 0;
  errors = 0;
  summaryDiv.innerText = "";
  audio.src = lesson.audio;
  toneButtonsDiv.innerHTML = "";
  ["mÄ","mÃ¡","mÇŽ","mÃ "].forEach((tone,i)=>{
    const btn = document.createElement("div");
    btn.className="tone-btn";
    btn.innerText = `${tone} (${i+1})`;
    btn.dataset.tone=tone;
    btn.dataset.key=i+1;
    btn.addEventListener("click",()=>handleTone(tone));
    toneButtonsDiv.appendChild(btn);
  });
}

function handleTone(tone){
  if(!currentLesson) return;
  const correct = currentLesson.sequence[currentIndex];
  if(tone===correct){
    showPopup("PERFECT","linear-gradient(45deg, #4caf50, #8bc34a)");
  } else {
    showPopup("MISS","linear-gradient(45deg, #f44336, #ff7961)");
    errors++;
  }
  currentIndex++;
  if(currentIndex>=currentLesson.sequence.length){
    summaryDiv.innerText=`Lesson complete! Total errors: ${errors}`;
  }
}

function showPopup(msg, bg){
  popup.innerText=msg;
  popup.style.background=bg;
  popup.classList.add("show");
  setTimeout(()=>popup.classList.remove("show"),600);
  const sparkle = document.createElement("div");
  sparkle.className="sparkle";
  sparkle.innerText = msg==="PERFECT"?"â­":"ðŸ’¥";
  sparkle.style.left=(toneButtonsDiv.offsetLeft + Math.random()*toneButtonsDiv.offsetWidth)+"px";
  sparkle.style.top=(toneButtonsDiv.offsetTop + Math.random()*50 + 50)+"px";
  document.body.appendChild(sparkle);
  setTimeout(()=>sparkle.remove(),1000);
}

document.addEventListener("keydown",(e)=>{
  if(!currentLesson) return;
  const btn=[...document.querySelectorAll(".tone-btn")].find(b=>b.dataset.key==e.key);
  if(btn) handleTone(btn.dataset.tone);
});
</script>

</body>
</html>


